Надо сделать приложение, которое способно работать с fog-файлами. Некоторую основу я уже сделал. Берется fog-файл и 
переводится в корректную форму. Пока это касается только раскрытия iisstore, но можно (и нужно) расширить трансформации.
Итоговый XElement может сохраняться в виде файла. 

Для чего такие преобразования нужны? Во-первых, для более "аккуратного" представления fog-файлов, сказывающееся на 
скорости загрузки и использовании оперативной памяти. Во-вторых, для коррекции документов. Фактически, для перевычисления 
специальных (small, medium, normal) представлений мультимедиа.

Документы находятся через анализ fog-файлов. Вопрос в том, что запись документа может иметь uri вне данной кассеты. 
В принципе, можно работать с базой данных через API FactographData, но это будет уже другая история. 

### 20240510 10:12
Два или три дня я думал над выявленной ситуацией. Действительно, базироваться в переделках документа на первом описании,
опасно потому что потом это описание может перекочевать в другой fog-файл. В то же время, я не могу использовать всю базу
данных, по крайней мере, это затруднительно. Сейчас я склоняюсь к "ненадежному" решению, когда анализ и коррекция ведется 
первого описания документа. Дело в том, что атрибуты uri и docmetainfo не должны меняться со временем и при редактировании 
записи документа. В таком случае, старые значения этих атрибутов сохраняться в отредактированных копиях. Для uri - это 
очевидно, для docmetainfo - это не так, поскольку мы хотим менять метаинформационные поля, напр. ширину и высоту. Однако, 
я пока эти поля не использую, они нужны при создании превьюшек. Более того, от этих атрибутов и в последнем случае можно 
отказаться. Напр. уменьшая образ в 2 и в 4 раза. 

Попробую сделать как задумал. Для этого надо fog-документ перевести к каноническую форму. Если там выявляются ММ-документы,
то, в некоторых случаях, надо корректировать ширину и высоту, а если есть возможность - то и время съемки. При такой 
трансформации будет накапливаться командный файл для исполнения после фиксации нового варианта fog-документа. 

Действие 1. Создать кассету, с которой будут проводиться эксперименты. В кассете должны быть фотки, видео, аудио, PDF.

Сделал. Но далее был обед с Натальей Павловой, потом прогула по городку, теперь сел продолжить. Кассета t1 есть и содержит 
нужный контент. Теперь надо попробовать сделать программу нормализации фога. Работаю с метаинформацией.

### 20240511 07:41
Вчера сделал нужное преобразование для постого случая с получением канонической формы. Теперь надо бы добавить отметку 
времени, операторы уничтожения и подстановки. Это будет полный случай. Кстати, простой случай уже продемонстрировал 
работоспособность в использовании SypBlazor.

Есть еще одна недоделка в предыдущих разработках. Это формат вставления fog-документа. Там нет определения пустого 
пространства имен. Это легко исправить. Может быть, легко...

Оказалось, что не легко. Пришлось корректировать CManager, а он у меня очень старой версии. Тем не менее, домашний компьютер
сработал с этим кодом нормально. Осталось исправить загрузку аудио. 

Загрузку аудио исправить не удалось. Придется делать какое-то другое решение. Теперь я умею превращать метаинформацию в 
каноническую форму, при добавлении пользовательского RDF, файл, хоть и с пустым содержимым, сделан каноническим и если его 
изменения будут корректными, то все будет нормально. Теперь подхожу к коррекции метаинформации о документах. 
С метаинформацией по имиджам - считаю все нормально. Нужно взять метаинформацию по видео файлам и поместить в
docmetainfo.

Теперь "подкрадываюсь" к главному преобразованию. Идея заключается в том, чтобы обработать одну кассету. 
То есть, беру фог из метаинформации, преобразую его в каноническую форму, потом делаю подмену на 
вычисленное значение. При преобразовании, нахожу multimedia документы и пытаюсь что-то доделать. Для видео
с помощью MediaInfo определяю ширину и высоту кадра. Эти параметры вставляются в docmetainfo. Далее, 
обращаем внимание на дефолтные значения по преобразованиям. Сбрасываем преобразования в командный файл. 
Потом исполняем этот командный файл. Хорошо бы отслеживать  уже сделанные преобразования, но где это 
фиксировать, я не знаю. Поэтому буду формировать полный командный файл. 

### 202405 08:06
День Пионерской организации! Как давно это было...

Вчера нашел неточность в программе преобразования кассет, в части вычисления превьюшек. Это из-за MIME-тонкостей,
напр. расширения jpeg и jpg означают одно и то же, но надо это учесть. Пока оставлю эту тему, попробую доделать 
программу до работающего варианта. Для этого, как минимум, надо добавить определение метаинформации для видео и
перевычисление превьюшек. Попробую.

Делание превьюшек я "добил" (разве что аудио под вопросом), теперь надо для видео корректировать ширину и высоту кадра. 
Пока кадр получается со стандартными размерами, в итоге получается пустое место в кадре, особенно для вертикальных кадров. 

Пора заняться получением метаинформации через MediaInfo. 

### 20240520 09:45
Наконец, собранная конструкция заработала. Новая метаинформация не фиксируется в базе данных, но используется для вычисления
превьюшек. Надо маленько доделать и провести эксперимент напр. с семейным архивом. Доделать - это изменить место расположения
рабочих файлов и как-то организовать массовое перевычисление превьюшек. 

### 20240521 11:26
Я экспериментировал с Syp-массивом кассет. Выяснилось, что "главная" кассета SypCassete попрождает дефектные изображения
малениких фоток, пришлось разбираться. Разобрался, нашел подходящий старый вариант и потратил пару часов на то, чтобы маленькие 
оригиналы вручную заместить большими или средними. Справился, проверил. Теперь надо проверить работу конвертированных видео.

Проверил, работает. Улучшил визуализацию тем, что не фиксирую размер кадра, визуализируется в естественных размерах. 

Что теперь? Надо бы трансформировать кассеты семейного архива. 

### 20240522 12:12
При попытки поработать с семейным архивом, выяснилось, что некоторые кассеты не имеют наполнения раздела originals. А поэтому,
перевычислить превьюшки я не могу. Далее, я пошел по ложному пути и потратил некоторое время. Потом одумался и задумался о
том какие преобразования должны выполняться над кассетами. 

Пока видится два режима работы CassConsoleApp - вычисление превьюшек для конкретной кассеты или набора кассет и, второй 
замена оригиналов на более компактные, напр. tiff на jpeg. В дальнейшем, можно будет подумать о коррекции фог-документов. 
Итак, есть команда и есть путь к кассете или пути к кассетам. Последнее реализуется через использование файла с именем 
config.xml. Команда: preview | compress. Далее, вроде понятно. Попробую...

Перекомпоновал программу, оставил в "подвешенном" состоянии формирование канонического фога, испытал на вычислении превьюшек 
для некоторого теста. Теперь надо сделать режим compress. Вроде режим сделать довольно просто. Надо сканировать элементы,
выявлять фото-документы, находить их расположение, формировать источник и цель и делать преобразование.

### 20240523 05:03
Вчера вечером проводил большой (долговременный) эксперимент. Я преобразовывал некоторые кассеты в сжатую (compress) форму и
вычислял превьюшки. На этой второй операции - программа сбилась, выявила некорректное определение или использование 
xmlns. Действительно, в базе данных есть записи вида:
```
  <photo-doc rdf:about="Ma_0001_0223">
    <name>Ma 639_143</name>
    <comment>I:\Папка 639 Архив Г.И. Марчука (Документы и награды)\125 Список трудов\639_143.tif</comment>
    <iisstore uri="iiss://Ma@iis.nsk.su/0001/0001/0223" originalname="I:\Папка 639 Архив Г.И. Марчука (Документы и награды)\125 Список трудов\639_143.tif" size="11972832" documenttype="image/tiff" documentcreation="2022-02-17T05:46:41" documentfirstuploaded="2022-02-17T13:15:31" documentmodification="2021-06-08T06:54:37" checksum="qwerty" width="1701" height="2342" transform="" />
  </photo-doc>
```
А рядом записи вида:
```
  <document rdf:about="Ma_1005" mt="2022-02-17T13:15:46" xmlns="http://fogid.net/o/">
    <name>095 Записка об АН</name>
  </document>
```
Здесь есть две неточности: определение xmlns и использование mt вместо mT. Кажется, эти фрагменты порождены манипуляциями
по объединению в один документ частей (DocumentPart) документов. Странно также, что такие вставки произведены прямо в
current fog-файлы. Надо понять за что конкретно программа "цепляется". 

Возможно, я сделал стратегическую ошибку сопоставив пустое пространство имен с http://fogid.net/o/. Но что теперь делать? 
Исправлять все фоги? Не так уж их много накопилось. Но и не мало. Кажется, программу CassConsoleApp надо расширить командой
типа canon. И переводит кассеты и наборы кассет в каноническую форму. Есть нюанс: дополнитлеьные fog-файлы. Надо подумать
и, возможно, провести эксперимент. А много ли таких объявлений xmlns="..."? Посмотрел через far - многовато. Причем в 
разных вариантах: есть и с дефолтным определением, есть и посреди текста есть и в delete/substitute...

Что делать - до конца непонятно. Решил, что буду продолжать тестирование, а в сложных затыках вручную выпровлять текст 
фог-файлов. Начну с метаинформации к Ma.

С модернизацией (компрессия и перевьюшки) фамильного сайта я справился. Выглядит лучше. Теперь надо двигаться дальше. 
Я вспомнил, что вроде выявил ошибку в формировании древовидного построения и не смог придумать как ее устранить. И я 
эту ситуацию оставил в подвешенном состоянии. 

Надо попробовать выявить ошибку, если она есть. А потом искать способ устранения. Какие данные нужно ввести для того,
чтобы получаемый портрет был бы нетривиальный? Персона, имя, дата рождения, описание на разных языках, один родитель,
два-три ребенка, степени и награды. 

### 20240526 20:50
Разработка движется. После того, как я исчерпал идеи по поводу софта, который совершенствоал (MagBlazor,
CassConsoleApp), я решил заняться проектом минимального построения визуального образа фактографических 
сборок. Сегодня я занимался общим (художественным) дизайном, кое-чего добилася, можно продолжать. 

Требуется сделать определенные действия: 
1) Замаскировать служебные поля uri и docmetainfo.
2) Сделать вывод массивов документов в виде двумерной композиции (скорее всего, wrap).

Пока достаточно. Первый пункт я сделал, надеюсь там все корректно... Теперь задумаюсь о втором.
Можно пока "по-старому", сделать фотку или иконку. Наверное, это будет правильно. Только надо найти 
wrap-панель. 

### 20240528 15:22
Работа идет. То, что я запланировал, более или менее сделано. По мере испытаний и тестирования, выявилась "старая болячка",
которая уже проявляла себя: это какое-то наложение пустого пространства имен xmlns=... Я недоделал этот момент по причине
обязни менять базу данных. В принципе, приложение CassConsoleApp умеет вычислять новый fog-файл в канонической форме. 
Но подменять страшно... Хотя я придумал как это можно сделать без излишнего риска. Надо ввести в атрибуты fog-файла еще один
- версию. Тогда если при начале работы с файлом нет этого атрибута, значит это старый формат, если есть и нужная версия, 
то это оно... Такой способ позволит работать со всем массивом кассет и фог-документов и, при этом, постепенно переводить 
их в каноническую форму. Что дает каноническая форма? Надеюсь, что много. Во-первых, должны устраниться колизии по 
пространствам имен. Во-вторых, есть более экономная схема построения базы данных, а это важно. Уже сейчас, на некоторых 
больших данных, построение БД происходит за 1 минуту. Это долго... Я хочу расчитывать на объемы архивов в 100 раз 
превышающие нынешние. 100 минут еще не фатально, но уже напрягает. Еще больше напрягает объем захватываемой оперативной 
памяти. На упомянутых больших данных, это около 1 Гб. А это уже многовато. Сейчас я реализовал пару схем, которые 
захватывают раз в 10 меньше ОЗУ, над этим можно и нужно работать!

Попробую поработать с CassConsoleApp. Хорошо бы сначала четко зафискировать тестовые данные, дающие ощибку при обработке.

### 20240601 18:05
Вот и лето наступило... 

Я совершенствую Publicuem2, сейчас пора испытать на разных данных. 

### 20240602 12:33
Испытания привели к проблемным результатам. Более того, к нестабильным результатам. Для списков отражений,
некоторые отражения не воспроизводились. Попытка выявить причину как-то не удалась. Пока я не поменял
адаптер на rr, теперь вроде проблемы ушли. Хотя я не уверен. Не хочется расстоваться с адаптером upi,
но я не могу найти причину ошибки. Пока сосредоточусь на испытаниях решения Publicuem2 с адаптером 
rr. Попробую установить на своем рабочем компьютере. 

Вроде более или менее получается. Добавил документы, состоящие из частей. Пока нет сортировки частей. 

Сортировку сделал, но испытать негде - у меня документы, состоящие из многих частей, есть в открытом 
архиве. Хотя и в семейном также... 

### 20240610 20:26
Кажется, добился стабильности в работе SypBlazor и Publicuem2. Но надо двигаться вперед. Есть следующие
задумки: а) делать увеличение фотки от medium до normal (и обратно...); б) делать выдачу любого оригинала;
в) обеспечить маршрут - сложная фотка-оригинал-редактирование-сохранение фрагмента. 

### 20241228 12:12
Сейчас, перед Новым годом и каникулами, я хочу "разогнаться" в разработке фактографической системы. Я много забыл,
многое так и не доделал, но двигаться надо. Вспоминаю, соображаю, экспериментирую. Сейчас пытаюсь довести 
программу CassConsoleApp. Для этого надо ее сначала проанализировать. Попробую. 

Программа запускается из консоли и имеет параметры. Сначала идет команда preview|compress|collect, второй параметр 
- имя конфигурационного файла. Файл пока имеет стандартный вид config.xml. Есть вариант прямого задания (одной) 
кассеты, но пока я этот маршрут не опробовал, сейчас можно задать только одну. Отличается вариант тем, что концовка
второго параметра не config.xml. Для удобства пуска из студии и отладки, параметры можно задать в тексте 
программы как дефолтные. Также в тексте программы задается место для кода используемых приложений. Обычно это 
D:\Home\bin или C:\Home\bin. Список имен фог-файлов, предназначенных для данной обработки формируется в 
string[] cassnames. 

Следующий раздел называется "Развертка collect". Он запускается только если команда collect. 
Я уже не помню что это означает, придется поанализировать. В разделе из набора имен кассет формируется список
имен фог-файлов. В список помещается база данных из meta и все фоги, зарегистрированные в этой части базы данных.
Далее, в разделе делается цикл по таким фог-файлам. Фоги нормализуются, в частности, делается XML-документ 
с правильной конструкцией: с проставленными простраствами имен rdf и дефолтного. Еще находятся записи с элементами
iisstore, они преобразжуются в корректные конструкции. Сделал некоторую недоделку, испытал режим, вроде работает.
Команда collect больше ничего не делает, программа заканчивается. 

Следующий раздел выполняется без указания команды, т.е. для всех (остальных). Снова проводится цикл по кассетам. 
Здесь в программе задается значение структуры finfo, определяющей размеры превьюшек. 

Далее, идет раздел "compress" в котором данные tiff формата, преобразуются в jpeg. В базе данных это не фиксируется,
но это желательно учесть в выводе оригинала. 

Вроде все преобразования сработали. Правда заминка произошла на AVI-видео. Определитель типа файла дал
video/x-msvideo, а такого расширения у файла нет. Плохо только некоторая "безтолковость" корректора CassConsoleApp.
Что-то надо корректировать с одной командой, что-то с другой, что-то с третьей. Кроме того, довольно частое в 
практике действие по сжатию оригинала (часто оригинал сжимается во много раз). Надо бы сделать концептуально более 
простую схему. Там еще есть итоговая "канонизация", надо посмотреть что она делает. Похоже - ничего, надо убрать.
Еще одна проблема текущего решения: длительность обработки. На каждое действие запускается тот или иной процесс.
Но процесс может оказаться безуспешным. И к чему это приведет? Кроме того, на обработку тратятся ресурсы. Более 
экономным и надежным выглядит формирование командного файла и последующий пропуск его. В общем, похоже задача еще
не решена. Да, еще одна потенциальная проблема: формируются файлы на замену существующих. А как заменять? Можно 
новому файлу добавить к имени что-нибудь вроде ".xml". Это решение неудобно из-за того, что надо вручную искать эти 
расширенные имена, находить оригиналы файлов, оригиналы уничтожать, новые - переименовывать. Тут можно и ошибиться!
Другое решение - сразу делать такую замену. Здесь понятно мы будем хуже контролировать результат. В обеих случаях,
откат назад как-то не просматривается...

### 20250207 12:44
Я пытаюсь регуляризовать кассеты семейного архива. Это надо бы сделать с помощью средств данного проекта (CassConsoleApp).
Пока не могу даже начать. Это потому, что нет уверенности в надежности осуществляемых преобразований. Что делается и
что надо делать? 

Есть технические недоделки. В частности, директорию внешних программ, надо бы "таскать" с проектом. Также не достаточно
структурированы параметры, отстуствует "нормальный" способ включать и выключать этапы преобразований. Потом не совсем 
ясно как задавать параметры создания превьюшек. 

Начал "разгребать" указанные "завалы". Во-первых, нашел подходящий способ вычислять место запуска. Далее - три директории 
"вверх" и одну "вниз" на фиксированную директорию с кодами программ. Это разрешает вопрос с привязкой бинарников внешних
программ. Проверил работу кассете с фильмами. Все бы хорошо, но видео обрабатываются долго! Если это запускать каждый
раз, будет неоправданно затанута обработка. С превьюшками фильмов можно поступить довольно просто: если превьюшка уже
есть, то ее не вычислять, если нет - вычислять. Пока непонятно как вычислять сжатую копию оригинала, ну да ладно...

С превьюшками фоток можно поступить приблизительно также, но пока отложу этот вопрос. А с видео надо бы сделать.

### 20250209 06:48
Итак, кое-что я переделал в преобразователе кассет, теперь надо все доделать и испытать. Больно сильно сомнения
гложат. 

Значит, иду по следующему маршруту: а) обрабатываю заданные кассеты; б) в кассетах выделяю фог-документы; 
в) в фогах нахожу документы такие, как - фоги, - фото, - видео. Каждую из этих записей можно и нужно использовать
для каких-то коррекций. Фоги корректируются через изменение записи - вынесение iisstore. Записи <photo-doc> дают
возможность корректировать оригинал и, если надо - превьюшки. Записи <video-doc> используются для того, чтобы
вычислять/корректировать превьюшки. Теоретически, можно также корректировать оригиналы видео. 

Есть проблема или проблемка: записи могут дублироваться (с разными временными отметками), могут быть уничтожены. 
И, самой страшное, идентификаторы могут быть переименованы. По изменению фог-записей - можно изменять все дубли.
По фоткам - изменять tiff получится однократно если tiff уничтожать. Все то же самое, в случае видео. Таким образом,
самое надежное - просто уничтожать все, что может вызывать повторные преобразования. Откатов назад не получится, но
что поделать... Главное - проверять наличия файлов.

### 20250210 10:45
Медленно, очень медленно, но продвигаюсь в совершенствовании программы CassConsoleApp. Сейчас делаю замену tiff-ов
на jpeg-и. Сам файл я заменяю, теперь надо заменить метаинформацию о нем. Это раздел docmetainfo documenttype:image/tiff (image/tif)
который надо заменить на documenttype:image/jpeg. Пожалуй, сделаю. Также надо бы сделать параметр типа -tiff для включения опции 
преобразования тифов в жипеги. 

Смутила меня логика, которую надо выработать и воспроизвести. Проблема в том, что фог-документ иногда надо изменять. 
Такое "иногда" бывает когда а) формируется более поздняя версия документа на основе старого; б) производятся изменения в 
метаинформации документа или документов, напр. при замене tiff на jpeg. Случай a) - проще, надо всегда сохранять элементы в заготовке,
а потом записать сформированный документ по месту. Случай б) - несколько сложнее. Сложность возникает из-за того, что мы не знаем
появится ли изменяемый элемент или нет. Это значит, что заготовку надо формировать, а решение о ее сохранении принимать в конце 
формирования. Таким образом, в логике приложения должны присутствовать следующие переменные: 
- to_convert_tiff (-tiff) - внешнее указание, что надо конвертировать tiff в jpeg, когда есть возможность. 
- to_convert_video (-video) - внешнее указание, что надо конвертировать оригинал video в MP4, когда есть возможность. 

### 20250213 08:39
Что-то я застопорился. Причем на простом вопросе: как указывать оригинал, который надо компрессировать. Это надо, потому что
многие источники (фотки, телефоны) или авторы (корресподенты и др.) слишком "шикарно" пишут видео, напр. взятое у меня 
интервью тянет на 2.6 Гб в том же MP4, а нормально сжатое - 602 Мб, это даже без "игры" параметрами сжатия. Но в общую схему 
обработки CassConsoleApp не ложится. В отдельную программу выделять неудобно. В конце концов решил, что это будет специальная
опция в кассетном приложении, но пока не смог собраться для того, чтобы доделать его. У меня согодня в 10 семинар, а потом прийду
и начну работать.

Начал, но уже в 15:51... Тем не менее. 

### 20250215 12:49
В общем, с огромной потерей времени, я сделал начальный вариант программы CassConsoleApp. Проверил в разных режимах. Для запуска 
превьюшек, превьюшки не должны существовать или их (частично) надо уничтожить. Попробую выйти на комплексный тест. 

Попробую это сделать с какой-то копией кассет семейного архива. 

### 20250216 11:42
Какую-то подборку кассет архива я сделал. В основном, это те, которые использовались в текущей версии ИС Family. 
Теперь надо "оживить" подборку. Правильнее всего, начать "оживлять" приложением MagBLazor. Попробую. 

### 20250217 17:22
Подборку "оживил", потом попробовал переработать применив CassConsoleApp, вышел на ошибку, оказалась в данных, исправил, вышел
на вторую ошибку в данных. Исправил, преобразование завершилось, проверил работу средствами MagBlazor. Трудно сказать, но вроде 
работает. Теперь надо бы найти и исправить ошибку в редактировании по которой получалась ошибка в данных. 

Теперь можно сделать более регулярную систему работы с кассетами с нацеленностью на серверное решение. 

### 20250218 10:08
Провел эксперимент по редактированию данных. Как то все не так... Во-первых, пустая кассета, которую я специально сделал, 
не пожелала преобразовываться в формат fogid-2024. Во-вторых, при редактировании, получился авост. Возможно, это произошло из-за
(моей) путаницы при создании отношения члена коллекции. Но почему авост? Надо разбираться.

### 20250221 11:46
Я застрял на поиске ошибки при преобразовании данных средствами CassConsoleApp. В конце концов, разобрался. Дело в том, что (кроме
всего прочего) видимо magic.exe, которую я использую в качестве программы преобразования имиджей, иногда делает лишнее, напр. пишет
не один результирующий файл, а два, при этом, расширяя его имя. В принципе, это можно контролировать. Но я продумал и альтернативный
путь - использовать библиотечные решения по работе с имиджами, которые я использовал в CManager'е. Или другие аналогичные. Я посмотрел,
там истинно принципиального кода будет немного.  

### 20250228 10:37
Сегодня День рождения Пети. Как быстро летит время, ему уже 42...

Через неделю решил вернуться к разработке Фактографа. Тем более, получил звонок, что soran1957 не работает. Видимо машина остановлась.
А еще я приостановился из-за мыслей, что надо бы сменить схему обработки в CassConsoleApp. Дело в том, что разработанные средства 
можно использовать и для ввода данных Веб-приложением. Но надо получить откуда-то метаинформацию о документе. По видео я ее беру из 
запуска MediaInfo, а по фото из docmetainfo. Там она вычисляется при работе CManager'а. Надо от него избавиться, поэтому надо все-таки 
иметь возможность получения метаинформации не только из существующих данных. Метаниформацию можно получать через запуск MediaInfo или 
при прямой работе с имиджем. 

Итак, начну с библиотеки. Первое, что надо сделать, это получение метаинформации о документе. Сделаю процедуру.

### 20250303 12:00
В общем, я похоже разобрался в EXIF. По крайней мере, нашел код 36867 с помощью которого можно доступаться к времени съемки
```
var pr2 = im.GetPropertyItem(36867); // TagExifDTOrig
var t2 = Encoding.UTF8.GetString(pr2.Value);
```
По ходу, пришлось очень много искать некоторую ошибку, которая оказалась в том, что преобразование с помощью magic.exe
не формирует ряд тегов, в том числе и указанный, а это приводит к ошибке. Кажется так... Это уже вторая выявленная 
ошибка. Вывод заключается в том, что для имиджей надо отказаться от внешней программы Magic. Может я даже выиграю, надо
пробовать. 

Попробую набросать маршрут обработки. Что делать с новыми документами я пока не продумал. Пусть имеется набор кассет
как в предыдущем случае. Я сканирую фог-файлы, нахожу документы и, в зависимости от их типа, произвожу некоторые 
действия. Действия с фотками можно сгруппировать в единый пакет. Сначала я смотрю на имеющиеся метаданные по документу.
Если файл имеет расширение tif, то надо корректировать оригинал и корректировать docmetainfo. После этой корректировки
вычисляются превьюшки. Да и то, если а) было преобразование tiff -> jpeg; б) или превьюшки не обнаружено. 

Буду пробовать. Пожалуй, надо собрать новое приложение. Пусть это будет CassCorrect. 

### 20250312 10:52
Прошло 2 недели, я занимался перевозкой документов. Сейчас вроде уже назад акклиматизируюсь, могу продолжить. 

В принципе, новая схема обработки мне нравиться больше. По всем указанным в конфигураторе кассетам, собирается информация 
о fog-файлах. Потом фоги перебираются и каждый из них сканируется. При этом, строится новый вариант фога в виде XElement
объекта. Также, когда надо, помечается флаг tochange = true. Начальное состояние флага false если стоит нужная версия 
фога, иначе он сразу true. Также он может стать true если производится изменение какой-нибудь записи, напр. фотодокумент
изменяется с tiff на jpeg. Конкретно в данном случае, перевод tiff->jpeg будет осуществляться при наличии параметра -tiff.

Это все касалось изменений в fog-файлах. Далее, при анализе записей, выявляются записи определенного вида. Пока это
фотки и видео. По фоткам: если есть преобразование tiff'а и это есть tiff, то оригинал прочитывается в битмап. Далее,
проверяется надо ли делать превьюшки. Параметры превьюшек фиксируются в файле cassette.finfo, а необходимость вычисления -
в отсутствии файла превьюшки на месте. Если надо вычислять хотя бы одну превьюшку для этого документа, а битмап остутствует,
то битмап прочитывается. Потом вычисляются превьюшки и располагаются по местам. 

С видео, выполняется только создание превьюшек (пока я делаю только medium). Попробую продвинуться что ли...

### 20250314 16:26
Двигался, двигался и вдруг - застрял... А застрял я на осознании того, что часть архитектуры кассетной организации
НЕ ДОДУМАНО! Действительно, для документов, в том числе и ММ-документов, базисно верна схема распределения записей
и наличия множества одинаково идентифицированных записей с определением последней как оригинала. При коррекции, я не
строю базу данных и не определяю множеств одинаковых. Я просто последовательно беру запись и работаю с ее полями. 
В частности, с uri и docmetainfo. Как с этим быть? В принципе, если не меняются данные по uri и docmetainfo,
вроде все в порядке - оин копируются во все копии без изменений. uri не должен меняться по построению. docmetainfo
может меняться через изменение типа графики, ориентации, размеров, дат и др. 

В свое время я совершил ошибку тем, что отказался от разделения файл-документ с обратной ссылкой на документ. Если бы 
так, то документ можно было бы привязать к кассете (и даже к current-фог) и запретить изменять его средствами 
редактирования. Это было бы логично, также как логично не менять собственно документ. Процедура коррекции тогда была 
бы надежной. 

А что делать сейчас? Пока мета-поля находятся внутри документа, нужно сделать документы мало изменяемыми. Вообще-то
критичным в смысле возникших проблем является только uri. Как это использовать - непонятно. Можно, конечно, ничего не
делать...

### 20250315 10:01
Кажется, я прихожу к решению. Поля uri и docmetainfo я в документах пока оставляю, но верным считаю только uri, 
а для docmetainfo завожу 

```
  <Class rdf:about="http://fogid.net/o/File">
    <label xml:lang="ru">Файл документа</label>
    <label xml:lang="en">File of document</label>
    <SubClassOf rdf:resource="http://fogid.net/o/sys-obj"/>
  </Class>
  <ObjectProperty rdf:about="http://fogid.net/o/forDocument" priority="a" essential="yes" weight="35">
    <label xml:lang="ru">для документа</label>
    <label xml:lang="en">for document</label>
    <inverse-label xml:lang="ru">контент</inverse-label>
    <inverse-label xml:lang="en">content</inverse-label>
    <domain rdf:resource="http://fogid.net/o/File"/>
    <range rdf:resource="http://fogid.net/o/document"/>
  </ObjectProperty>
  <DatatypeProperty rdf:about="http://fogid.net/o/uriCode" priority="o">
    <label xml:lang="ru">uri код</label>
    <label xml:lang="en">uri code</label>
    <domain rdf:resource="http://fogid.net/o/File"/>
    <range rdf:resource="http://fogid.net/o/string"/>
  </DatatypeProperty>
  <DatatypeProperty rdf:about="http://fogid.net/o/docmetainfo" priority="o">
    <label xml:lang="ru">docmetainfo</label>
    <label xml:lang="en">docmetainfo</label>
    <domain rdf:resource="http://fogid.net/o/File"/>
    <range rdf:resource="http://fogid.net/o/string"/>
  </DatatypeProperty>
  <!--
  <DatatypeProperty rdf:about="http://fogid.net/o/contentType" priority="o">
    <label xml:lang="ru">content type</label>
    <label xml:lang="en">content type</label>
    <domain rdf:resource="http://fogid.net/o/File"/>
    <range rdf:resource="http://fogid.net/o/string"/>
  </DatatypeProperty>
  <DatatypeProperty rdf:about="http://fogid.net/o/owner" priority="o">
    <label xml:lang="ru">owner</label>
    <label xml:lang="en">owner</label>
    <domain rdf:resource="http://fogid.net/o/File"/>
    <range rdf:resource="http://fogid.net/o/string"/>
  </DatatypeProperty>
  -->
```
File фиксирует uri и другую метаинформацию и имеет ссылку на запись документа, напр. фото или видео.
Этот файл заводится в current-фоге кассеты, его не разрешается редактировать, поэтому он всегда там живет. Зато 
специальное и ручное редактирование не портит логику, поскольку он в одном экзампляре. 

А с текущими полями что делать? Давай так: оставляю docmetainfo для совместимости, но не сильно поддерживаю. 
Для отличия ситуации, добавляю в docmetainfo какой-нибудь код и формирую MultimediaFile со ссылкой на данный документ.
Таким образом, "старый" софт должен работать. А новый софт будет опираться на новое оформление мультимедиа. А корректоры
и транформаторы будут опираться на введенный признак. Вначале списка метаинформации помещаем version:old; Как-то так...

### 20250316 09:18
И каждый раз, когда надо писать код, я отступаю... В этот раз я задумался о внешних ссылках на документы. Допустим,
есть (облачное) хранилище фоток или видео или разных документных файлов. И пусть хранилище имеет простое API, тогда
вместо файла документа, вполнен уместна ссылка на этот контент. А как сделать ссылку? Проще всего, через вариант 
uri. Действительно, в позиции uri можно поместить гиперссылку. Если результат гиперссылки возврат самого документа,
то это действует как файл. За исключением типа документа, который неизвестно куда девать. За исключением атрибутов,
разных вариантов размера и т.д. Если есть возможность, то лучше брать из источника копию документа, оформить ее как 
надо, а где-нибудь указать источник. Пока я не буду заниматься этой проблемой. 

Вернусь к проекту. Продолжу программу с учетом того, что я придумал и продумал. Новое, что повлияет на общую организацию
обработки, это работа с "главным" фог-файлом в кассете вместо работы со всеми. С другой стороны, работа со всеми
может быть важной для других обработок или для проверок. Например, если важное описание каким-то образом появилось 
в дополнительном фог-документе, это надо бы знать... Но для начала, обработку можно упростить на один цикл. 

Заметил еще один нюанс: фоги не рекуррентны в том смысле, что current-документ может иметь документы типа 
application/fog, а внутренние - нет. Прямого запрета нет, но кассетный менеджер этого не допускает. 

А если введение файла отложить и сделать как раньше? Если преобразовывать главные фог-документы, а может и все,
дефект подхода провится только при явном использовании метаинформации. Часто можно обойтись без этого. В конце концов,
если очень надо будет, можно будет доделать преобразования. Так что, для того, чтобы минимизировать количество ошибок,
буду делать изменения в основных фог-файлах.

### 20250320 13:14
Время идет, программа очень медленно совершенствуется. Сейчас она может пропускать без обработки те части данных, которые
обрабатывать не требуется, может преобразовывать tiff в jpeg, может делать превьюшки. До видео я пока не добрался, 
остановился на том, что надо правильно поработать с управляющими параметрами. Добиться автоматичности в преобразованиях.

Неудобство разработки в том, что если заменять реальные данных, трудно следить за изменениями и восстанавливать исходный
вариант. Но попробую. Сделаю контрольное состояние тестовой кассеты и начну шаг за шагом отлаживаться. 

Сделал копию оригинала. Буду проверять работу имеющихся средств. Первое - очень важно. Это преобразование фогов, включая
вспомогатлеьные в версию прошлого года. Без перевычисления имиджей. 

### 20250321 05:30
Вчера доделал работу с имиджами. Вроде все режимы работают. Пока сегодня просыпался, захотелось сделать достаточно большой
эксперимент по нормализации/преобразованию. Видимо его надо проводить на рабочем компьютере, заодно и коммит на гитхаб
надо бы сделать. 









