Надо сделать приложение, которое способно работать с fog-файлами. Некоторую основу я уже сделал. Берется fog-файл и 
переводится в корректную форму. Пока это касается только раскрытия iisstore, но можно (и нужно) расширить трансформации.
Итоговый XElement может сохраняться в виде файла. 

Для чего такие преобразования нужны? Во-первых, для более "аккуратного" представления fog-файлов, сказывающееся на 
скорости загрузки и использовании оперативной памяти. Во-вторых, для коррекции документов. Фактически, для перевычисления 
специальных (small, medium, normal) представлений мультимедиа.

Документы находятся через анализ fog-файлов. Вопрос в том, что запись документа может иметь uri вне данной кассеты. 
В принципе, можно работать с базой данных через API FactographData, но это будет уже другая история. 

### 20240510 10:12
Два или три дня я думал над выявленной ситуацией. Действительно, базироваться в переделках документа на первом описании,
опасно потому что потом это описание может перекочевать в другой fog-файл. В то же время, я не могу использовать всю базу
данных, по крайней мере, это затруднительно. Сейчас я склоняюсь к "ненадежному" решению, когда анализ и коррекция ведется 
первого описания документа. Дело в том, что атрибуты uri и docmetainfo не должны меняться со временем и при редактировании 
записи документа. В таком случае, старые значения этих атрибутов сохраняться в отредактированных копиях. Для uri - это 
очевидно, для docmetainfo - это не так, поскольку мы хотим менять метаинформационные поля, напр. ширину и высоту. Однако, 
я пока эти поля не использую, они нужны при создании превьюшек. Более того, от этих атрибутов и в последнем случае можно 
отказаться. Напр. уменьшая образ в 2 и в 4 раза. 

Попробую сделать как задумал. Для этого надо fog-документ перевести к каноническую форму. Если там выявляются ММ-документы,
то, в некоторых случаях, надо корректировать ширину и высоту, а если есть возможность - то и время съемки. При такой 
трансформации будет накапливаться командный файл для исполнения после фиксации нового варианта fog-документа. 

Действие 1. Создать кассету, с которой будут проводиться эксперименты. В кассете должны быть фотки, видео, аудио, PDF.

Сделал. Но далее был обед с Натальей Павловой, потом прогула по городку, теперь сел продолжить. Кассета t1 есть и содержит 
нужный контент. Теперь надо попробовать сделать программу нормализации фога. Работаю с метаинформацией.

### 20240511 07:41
Вчера сделал нужное преобразование для постого случая с получением канонической формы. Теперь надо бы добавить отметку 
времени, операторы уничтожения и подстановки. Это будет полный случай. Кстати, простой случай уже продемонстрировал 
работоспособность в использовании SypBlazor.

Есть еще одна недоделка в предыдущих разработках. Это формат вставления fog-документа. Там нет определения пустого 
пространства имен. Это легко исправить. Может быть, легко...

Оказалось, что не легко. Пришлось корректировать CManager, а он у меня очень старой версии. Тем не менее, домашний компьютер
сработал с этим кодом нормально. Осталось исправить загрузку аудио. 

Загрузку аудио исправить не удалось. Придется делать какое-то другое решение. Теперь я умею превращать метаинформацию в 
каноническую форму, при добавлении пользовательского RDF, файл, хоть и с пустым содержимым, сделан каноническим и если его 
изменения будут корректными, то все будет нормально. Теперь подхожу к коррекции метаинформации о документах. 
С метаинформацией по имиджам - считаю все нормально. Нужно взять метаинформацию по видео файлам и поместить в
docmetainfo.

Теперь "подкрадываюсь" к главному преобразованию. Идея заключается в том, чтобы обработать одну кассету. 
То есть, беру фог из метаинформации, преобразую его в каноническую форму, потом делаю подмену на 
вычисленное значение. При преобразовании, нахожу multimedia документы и пытаюсь что-то доделать. Для видео
с помощью MediaInfo определяю ширину и высоту кадра. Эти параметры вставляются в docmetainfo. Далее, 
обращаем внимание на дефолтные значения по преобразованиям. Сбрасываем преобразования в командный файл. 
Потом исполняем этот командный файл. Хорошо бы отслеживать  уже сделанные преобразования, но где это 
фиксировать, я не знаю. Поэтому буду формировать полный командный файл. 

### 202405 08:06
День Пионерской организации! Как давно это было...

Вчера нашел неточность в программе преобразования кассет, в части вычисления превьюшек. Это из-за MIME-тонкостей,
напр. расширения jpeg и jpg означают одно и то же, но надо это учесть. Пока оставлю эту тему, попробую доделать 
программу до работающего варианта. Для этого, как минимум, надо добавить определение метаинформации для видео и
перевычисление превьюшек. Попробую.

Делание превьюшек я "добил" (разве что аудио под вопросом), теперь надо для видео корректировать ширину и высоту кадра. 
Пока кадр получается со стандартными размерами, в итоге получается пустое место в кадре, особенно для вертикальных кадров. 

Пора заняться получением метаинформации через MediaInfo. 

### 20240520 09:45
Наконец, собранная конструкция заработала. Новая метаинформация не фиксируется в базе данных, но используется для вычисления
превьюшек. Надо маленько доделать и провести эксперимент напр. с семейным архивом. Доделать - это изменить место расположения
рабочих файлов и как-то организовать массовое перевычисление превьюшек. 

### 20240521 11:26
Я экспериментировал с Syp-массивом кассет. Выяснилось, что "главная" кассета SypCassete попрождает дефектные изображения
малениких фоток, пришлось разбираться. Разобрался, нашел подходящий старый вариант и потратил пару часов на то, чтобы маленькие 
оригиналы вручную заместить большими или средними. Справился, проверил. Теперь надо проверить работу конвертированных видео.

Проверил, работает. Улучшил визуализацию тем, что не фиксирую размер кадра, визуализируется в естественных размерах. 

Что теперь? Надо бы трансформировать кассеты семейного архива. 

### 20240522 12:12
При попытки поработать с семейным архивом, выяснилось, что некоторые кассеты не имеют наполнения раздела originals. А поэтому,
перевычислить превьюшки я не могу. Далее, я пошел по ложному пути и потратил некоторое время. Потом одумался и задумался о
том какие преобразования должны выполняться над кассетами. 

Пока видится два режима работы CassConsoleApp - вычисление превьюшек для конкретной кассеты или набора кассет и, второй 
замена оригиналов на более компактные, напр. tiff на jpeg. В дальнейшем, можно будет подумать о коррекции фог-документов. 
Итак, есть команда и есть путь к кассете или пути к кассетам. Последнее реализуется через использование файла с именем 
config.xml. Команда: preview | compress. Далее, вроде понятно. Попробую...

Перекомпоновал программу, оставил в "подвешенном" состоянии формирование канонического фога, испытал на вычислении превьюшек 
для некоторого теста. Теперь надо сделать режим compress. Вроде режим сделать довольно просто. Надо сканировать элементы,
выявлять фото-документы, находить их расположение, формировать источник и цель и делать преобразование.

### 20240523 05:03
Вчера вечером проводил большой (долговременный) эксперимент. Я преобразовывал некоторые кассеты в сжатую (compress) форму и
вычислял превьюшки. На этой второй операции - программа сбилась, выявила некорректное определение или использование 
xmlns. Действительно, в базе данных есть записи вида:
```
  <photo-doc rdf:about="Ma_0001_0223">
    <name>Ma 639_143</name>
    <comment>I:\Папка 639 Архив Г.И. Марчука (Документы и награды)\125 Список трудов\639_143.tif</comment>
    <iisstore uri="iiss://Ma@iis.nsk.su/0001/0001/0223" originalname="I:\Папка 639 Архив Г.И. Марчука (Документы и награды)\125 Список трудов\639_143.tif" size="11972832" documenttype="image/tiff" documentcreation="2022-02-17T05:46:41" documentfirstuploaded="2022-02-17T13:15:31" documentmodification="2021-06-08T06:54:37" checksum="qwerty" width="1701" height="2342" transform="" />
  </photo-doc>
```
А рядом записи вида:
```
  <document rdf:about="Ma_1005" mt="2022-02-17T13:15:46" xmlns="http://fogid.net/o/">
    <name>095 Записка об АН</name>
  </document>
```
Здесь есть две неточности: определение xmlns и использование mt вместо mT. Кажется, эти фрагменты порождены манипуляциями
по объединению в один документ частей (DocumentPart) документов. Странно также, что такие вставки произведены прямо в
current fog-файлы. Надо понять за что конкретно программа "цепляется". 

Возможно, я сделал стратегическую ошибку сопоставив пустое пространство имен с http://fogid.net/o/. Но что теперь делать? 
Исправлять все фоги? Не так уж их много накопилось. Но и не мало. Кажется, программу CassConsoleApp надо расширить командой
типа canon. И переводит кассеты и наборы кассет в каноническую форму. Есть нюанс: дополнитлеьные fog-файлы. Надо подумать
и, возможно, провести эксперимент. А много ли таких объявлений xmlns="..."? Посмотрел через far - многовато. Причем в 
разных вариантах: есть и с дефолтным определением, есть и посреди текста есть и в delete/substitute...

Что делать - до конца непонятно. Решил, что буду продолжать тестирование, а в сложных затыках вручную выпровлять текст 
фог-файлов. Начну с метаинформации к Ma.

С модернизацией (компрессия и перевьюшки) фамильного сайта я справился. Выглядит лучше. Теперь надо двигаться дальше. 
Я вспомнил, что вроде выявил ошибку в формировании древовидного построения и не смог придумать как ее устранить. И я 
эту ситуацию оставил в подвешенном состоянии. 

Надо попробовать выявить ошибку, если она есть. А потом искать способ устранения. Какие данные нужно ввести для того,
чтобы получаемый портрет был бы нетривиальный? Персона, имя, дата рождения, описание на разных языках, один родитель,
два-три ребенка, степени и награды. 

### 20240526 20:50
Разработка движется. После того, как я исчерпал идеи по поводу софта, который совершенствоал (MagBlazor,
CassConsoleApp), я решил заняться проектом минимального построения визуального образа фактографических 
сборок. Сегодня я занимался общим (художественным) дизайном, кое-чего добилася, можно продолжать. 

Требуется сделать определенные действия: 
1) Замаскировать служебные поля uri и docmetainfo.
2) Сделать вывод массивов документов в виде двумерной композиции (скорее всего, wrap).

Пока достаточно. Первый пункт я сделал, надеюсь там все корректно... Теперь задумаюсь о втором.
Можно пока "по-старому", сделать фотку или иконку. Наверное, это будет правильно. Только надо найти 
wrap-панель. 

### 20240528 15:22
Работа идет. То, что я запланировал, более или менее сделано. По мере испытаний и тестирования, выявилась "старая болячка",
которая уже проявляла себя: это какое-то наложение пустого пространства имен xmlns=... Я недоделал этот момент по причине
обязни менять базу данных. В принципе, приложение CassConsoleApp умеет вычислять новый fog-файл в канонической форме. 
Но подменять страшно... Хотя я придумал как это можно сделать без излишнего риска. Надо ввести в атрибуты fog-файла еще один
- версию. Тогда если при начале работы с файлом нет этого атрибута, значит это старый формат, если есть и нужная версия, 
то это оно... Такой способ позволит работать со всем массивом кассет и фог-документов и, при этом, постепенно переводить 
их в каноническую форму. Что дает каноническая форма? Надеюсь, что много. Во-первых, должны устраниться колизии по 
пространствам имен. Во-вторых, есть более экономная схема построения базы данных, а это важно. Уже сейчас, на некоторых 
больших данных, построение БД происходит за 1 минуту. Это долго... Я хочу расчитывать на объемы архивов в 100 раз 
превышающие нынешние. 100 минут еще не фатально, но уже напрягает. Еще больше напрягает объем захватываемой оперативной 
памяти. На упомянутых больших данных, это около 1 Гб. А это уже многовато. Сейчас я реализовал пару схем, которые 
захватывают раз в 10 меньше ОЗУ, над этим можно и нужно работать!

Попробую поработать с CassConsoleApp. Хорошо бы сначала четко зафискировать тестовые данные, дающие ощибку при обработке.

### 20240601 18:05
Вот и лето наступило... 

Я совершенствую Publicuem2, сейчас пора испытать на разных данных. 

### 20240602 12:33
Испытания привели к проблемным результатам. Более того, к нестабильным результатам. Для списков отражений,
некоторые отражения не воспроизводились. Попытка выявить причину как-то не удалась. Пока я не поменял
адаптер на rr, теперь вроде проблемы ушли. Хотя я не уверен. Не хочется расстоваться с адаптером upi,
но я не могу найти причину ошибки. Пока сосредоточусь на испытаниях решения Publicuem2 с адаптером 
rr. Попробую установить на своем рабочем компьютере. 

Вроде более или менее получается. Добавил документы, состоящие из частей. Пока нет сортировки частей. 

Сортировку сделал, но испытать негде - у меня документы, состоящие из многих частей, есть в открытом 
архиве. Хотя и в семейном также... 


