Комментарии к информационной системе Family

Как это должно выглядеть? Начальная страница может что-то объяснять, а может сразу давать выход на 
ресурсы, напр. на коллекции. Можно сделать так, что при отсутствии идентификатора, интерфейс приложения 
содержит информацию о том, что это за информационная система и как ей пользоваться.  

В общем, пока буду исходить из такой стратегии: если нет точки входа, то распечатывается некоторый текст.
Если есть точка входа, то она формирует начальный экран. Попробую это сделать. 

### 20230405 09:19
Попробую более регулярно поработать над дизайном семейного сайта. Посмотрю в каком он состоянии.

Первая проблема: при внешнем включении режима view, селектор выбора режима не переключается.  

Очень много времени потратил на поиск ошибки в построении генеалогического дерева. Даже пришлось 
восстанавливать старый вариант из репозитория. Теперь двинусь дальше. 

Делаю даты. Надо бы найти функцию, которую я уже писал. 

### 20230408 09:09
Дело застопорилось. Получилась какая-то inline композиция, но неполная... В общем, я запутался в
иерерхическом построении. Для преодоления, хочу сделать новый табличный визуализатор. Потом его можно
будет переделать в строчный. 

Итак, нам хочется построить портрет по идентификатору (а может и по записи). Будем делать портрет в 
компоненте типа BuildTablePortrait. В нем мы построим или возмем дерево Rec и отдельные части этого дерева
будем строить компонентом BuildTable. Возможно, будет иметь смысл выделить построение отдельного рядка. Но 
это - потом. 

Я увлекся вопросами устройства Asp.net, снова кое-что понял. Теперь идея заключается в 
том, чтобы собрать новую версию какого-то интерфейса под минимальным API и, может быть
через XML. Мне интересно это с двух позиций: во-первых, насколько это будет трудоемко и 
наглядно и, во-вторых, какая будет производительность решения. Есть ощущение, что 
razor-трансляция дорого обходится. Надо посмотреть...

### 20230409 08:57
Я все же начал проект. Потихоньку разбираюсь в "хитростях". Сначала искал способ получения 
аргументов (параметров) для построения страницы, нашел. Потом искал как выдать именно 
HTML-страницу, а не текстовую (явно не говорится о content-type). Также нашел. Потом 
увидел, что при создании приложения не появилась папка wwwroot. Посмотрел где она проявляется, 
понял, что никакими параметрами запуска она обычно определяется, посто завел "вручную",
папка появилась и в параметрах билдера. Наверное еще надо будет указать прямое использование
файлов из этой папки. Но пока двинусь дальше. 

Следующий шаг - придумать как грамотно оформлять отдельные страницы. Теоретически, можно 
сделать что-то вроде:
```
app.MapGet("/", Page1Delegate);
app.MapGet("/view/{id}", Page2Delegate);
app.MapGet("/edit/{id}", Page3Delegate);
...
Func<HttpRequest, HtmlResult> Page1Deledate = request => { ... }
```
Причем определение делегатов можно разнести по файлам через статические определения, 
погруженные в разные классы. Надо бы попробовать. Некоторая проблема заключается в том, что 
в делегат надо будет передавать разные наборы параметров. 

Вроде получилось нормально. И не требуется выделать id в параметрах делегата. Написал:
```
class ForDelegates
{
    public static HtmlResult Page1Delegate(HttpRequest request)
    {
        return new HtmlResult(new XElement("h1", "Empty work page").ToString());
    }
    public static HtmlResult Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        return new HtmlResult(new XElement("h1", "Empty work page: " + toprint).ToString());
    }
}
```

Следующий момент - использование потока вывода, нужно или нет - трудно сказать, но надо 
попробовать. 

Вроде получается... Код:
```
    public static void Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        request.HttpContext.Response.WriteAsync(toprint).Wait();
    }
```
Результат асинхронно "гонится" в поток вывода. Думаю, что пока это не актуально.

Вернемся к описанию делегатов. Надо постмотреть нельзя ли применить технику "страниц". 
Не придумал, хотя наверняка есть. В документации по минимальному API одна из рекомендаций
- именно тот вариант со статическими функциями, который я указал. 

Есть более интересный момент для попробования. Это получение сервисов. Попробую. Начну с
сервиса данных - он "потрясет" ситуацию по директориям и файлам. 

Сработало. Добавил в wwwroot файл с конфигуратором и файл с онтологией и все получилось. 
Только в параметры хендлера надо было добавить еще параметр с базой данных.

Что-то "бзикнула" идея по поводу того, что можно запускать неподготовленные для Web 
консольные приложения. Попробовал, не получилось, не очень то и хотелось...

Продолжаю. Теперь сервис базы данных есть. Сделаю верхнюю полоску, в которую потом помещу
поиск и авторизацию. Хотя авторизация может замедлить. А может и не замедлить...

Верхняя полоска. Сначала надо попробовать послать запрос от формы и принять его.
Посылаю две строки login и password. Потом пробую принять. Про полоску пока не думаю.

В общем, похоже, я "приплыл". Много времени потратил, чтобы запустить аутентификационный сервис,
но как-то не получилось... Возможно, есть способ интеграции двух подходов, возможно, это ничего 
не даст... А идея была, что razor-интерпретация требует ресурсов и времени. И что в это месте
можно ускориться. Как можно интегрировать разные подходы? Кажется, что при посылке реквеста на
обработку в зависимости от "карт", что-нибудь вроде:
```
app.MapGet("/view/{id}", ForDelegates.Page2Delegate);
```
И вот этот обработчик может без всякого razor/blazor построить новую страницу. Может быть, может быть...

Все же пора сделать что-то полезное. Я делал вьюер и хотел сделать табличный вьюер. Попробую вернуться 
к тому месту. 

### 20230411 12:52
Оказалось, что я не аккуратно сделал создание Rec-деревьев. Отсутствовали неиспользованные 
"веточки"-свойства. А это фатально для редактирования. Сейчас сделал изменения, получил нужную картинку.

В принципе, я могу и редактированием заняться и визуализацией. Но первая задача - ограничивать "видимость"
через шаблон. Как это сделать? Можно запрещать использовать классы, можно запрещать использовать свойства. 
Возможно, свойства - более эффективно. Простая схема ограничений будет работать, если будет работать 
редактирование базы данных с помощью "усеченных" записей. Это надо проверить. Кажется, я предпринимал для 
этого определенные усилия. 

У меня в голове есть определенная модель рестрикций. Я просто сделаю набор свойств, которые запрещены. 
Причем можно сделать симметричный запрет, когда объектные свойства запрещены в обеих направлениях, а можно 
сделать и несимметричный. Кажется, второе полезнее. Почему я так думаю, дело в том, что по практике 
предыдущих решений, система запретов позволяет к некоторым свойствам подходить только с одной стороны. 
Кажется...

Но есть еще первичные ограничения. В прошлый раз я делал их через темы: семья и др. Кстати, мо

### 20230413 
Я застрял на размышлениях по поводу возможности использования ограничений в древовидном построении.
Проблема заключается в том, что отредактированное значение надо записывать в базу данных. Но при этом, 
нельзя потерять информацию, которую возможно мы не использовали. Похоже, ограничения - это для вьюера. 
При выборе данного для редактирования, нужна вся запись. Попробую.

### 20230414 10:28
Я пытаюсь собрать более или менее приемлемую версию фамильного сайта. Идет медленно, но идет...

Сейчас постараюсь придумать какое-то более радостное оформление. Посмотрю фотографии. Какие могут быть 
идеи? Это может быть композиция из медалей, это может быть композиция из фамилий. Удачная фотография, 
может старая. Посмотрю фотографии и документы. 

### 20230415 15:30
Я доделал разработки режимов gene/edit/view, сделал новое оформление, закоммитил и запушил. Теперь хочу 
вернуться к идеям интерфейса look, в которых я пытался сделать ставку на "шахматку" из композиций. Теперь
у меня есть управляемое построение дерева Rec, соответственно следующий уровень Rec делается в виде
синтезируемой композиции (иконки) прямоугольного размера. 

Пока не начал, надо исправить выдачу прямой ссылки в представлении view. А то там нет ссылок, нет 
картинок. 

### 20230416 16:20
Постоянно "натыкаюсь" на проблемы, которые долго преодолеваю. Вот преодолел проблему в выводе документов.
А надо было поставить:
```
app.MapControllerRoute(name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}");
```

Интересно, что я недавно уже преодолевал эту проблему. Даже не проблему, а недогляд... 4 апреля, я Трошкову про это 
писал. Удивительно как быстро забывается...

Возвращаюсь к первой странице. Даже не первой, а view-странице. Буду делать страницу /view, а потом страницу 
/view/

### 20230417 16:28
Попробую сделать хоть немного. Это будет в режиме look. Беру идентификатор, нахожу RRecord, выделяю 
тип. В зависимости от типа, строю shablon. По шаблону строю Inline-композицию, но без чего-то главного.

### 20230418 11:58
Меня корреспонденка попросила сделать видимость работы. Вот делаю. На самом деле, мы с Трошковым во-многом
застряли. И у меня нет целостной картины использования Rec'ов и у него. 

Пожалуй попробую немного поработать. Идея заключается в том, чтобы какую-то часть информационного портрета
изображать inline, а другую каким-то композиционным способом. Попробую это сделать с коллекцией. 
Шаблон для нее я уже набросал

### 20230422 13:16
Была очень напряженая неделя и я не смог поработать над проектом. Появились некторые точки останова, которые 
попробую сформулировать. Во-первых, у меня нет ясности в том, как пользовать языковыми вариантами. Особенно, 
при редактировании данных. Идея заключается в том, чтобы многоязыковые поля изображались парой выбор языка - 
значение поля. При вводе такого языка может не оказаться, поэтому должна быть команда добавления языка.

Вторая точка останова заключается в принципах построения view-композиций на основе Rec-дерева. Третья точка - 
управление набором используемых отношений. Четверная точка - продумать использование фактографической системы 
для поодержания научного делопроизводства в ИСИ. Вроде много чего есть, но удобной технологии нет. 

Главное, что я застрял на оформлении первых страниц сайта. Попробую сделать это по-старинке. Я уже выделил объект коллекции, даже сделал начальный шаблон. Теперь разрисую этот объект. 

### 20230425 10:40
Сегодня и завтра я еще буду дома. Пости все дела уже отложены, можно поработать над проектом. Попробую
настроиться и не предрываться. Делаю Look-интерфейсы. Начал со странички оформления коллекции. Потом буду 
делать другие страницы, включая малые (200x200- композиции).

### 20230501 12:25
Вот мы уже четыре дня на Семинском перевале, в УТЦ. Погода практически зимняя, снегу навалом, куда-то пойти пролематично. С утра был неплохой морозец и образовался наст по которому, кажется, можно передвигаться. Предыдущие дни я работал над проектом "Заяц", который хочу подготовить к следующей ЛШЮП. Этот проект я готовлю с Мишей Ноговициным. Вроде что хотел - сделал. Пусть теперь Миша разбирается, а я могу заняться фактографичкими проектами. 

С некоторыми трудностями, удалось запустить проект на ноутбуке, который я взял с собой. "Поигрался" с данными, вроде все нормально. 

Что-то мне не нравится технология замены базы данных. Надо бы делать это не ручным очищением файлов, а по команде. Это делается в сервисе базы данных. Попробую...

#### 20230507 05:49
Презентационный интерфейс уже "задышал". Но надо выправить детали. Пообсуждаю.

В принципе, я могу управлять набором и порядком полей, прямых отношений и обратных отношений. Также глубиной раскрытия этих отношений. Но пока я работаю с универсальными раскрытиями. А потом предполагаю, что будут специализированные. Специализированные обязательно должны присутствовать поскольку требуется дополнительная информация к "маленьким" портретам. Для фотодокументов важна не только время съемки, но и место, а это уже требует дополнительного анализа отношения "отражение". С портретами персон - приблизительно также. Нужно найти портрет. 

Можно не пытаться построить все дерево сразу. А строить некоторую основу, а в ней заполнять информацию по имеющемуся типу отношения и типу объекта. Наверное, это можно регулировать двумя уровнями раскрытия: "большой" портрет и "маленький". У меня все это есть. Надо поработать над "маленьким". В принципе, есть еще inline-портрет, который используется в обычных отношениях. К таким отношениям относятся титулы и награды. Хотя и фотки медалей были бы уместны. Но куда их разместить? Отражение может быть? 

Я подумал, похоже надо добавить в отношение reflection ссылку на документ, свидетельствующий о титуле. Это может быть и фотодокумент и скан грамоты, диплома и т.д. Да и многостраничнфый документ тоже подойдет. Но это - потом. Сейчас важно сделать маленькие портреты персон. Сверху пишем "Персона", потом идет фотография, если есть, потом имя, потом даты жизни. Вместо "персона" можно и квалифицировать "отец" и т.д. На фотографию навешаем ссылку и выплывающую подсказку, куда поместим титулы, места работы. 

### 20230512 11:53
Пытаюсь настроиться на работу. Начну с исправления неприятности, свзязанной с ненахождением документа для внесения редактирования. Во-первых, надо постараться зафиксировать ситуацию при входе в режим редактирования, во-вторых, надо корректно отреагировать на ситуацию когда/если она возникнет.

Ситуация возникает когда или нет документа для редактирования этим оператором или документ не проставлен на запись. Создам тестовую ситуацию. 

### 20230513 09:38
Вчера все же сделал некоторое исправление. Хотя и не в полном объеме. 
Сделал проверку на наличие возможности вести запись под конкрентым именем пользователя.
Остались еще другие потенциальные проблемы в динамике работы с данными, вызывающие
прерывание, но пока можно оставить так как есть. Это потому, что я не придумал
общую схему или перехвата прерываний или аккуратного сопровождения ошибок. Но пока - все по этому вопросу.

С новыми силами займусь фамильным архивом. Что-то уже начало получаться, надо посмотреть
и выработать направления работы. 

Начал с персоны. Как-то пока не очень... В чем вопросы? 1-е - списки могут быть большими.
Хорошо бы сделать список, который "разворачивается". Хорошо бы сделать список на три положения. 
Напр. начальное положение - просто количество элементов в списке. Промежуточное положение - 
штуки четыре элемента. Полное раскрытие - весь список. Только нужно отказаться от 
разделения на заголовок и сам список. Еще хорошо бы иметь и четверное положение. 
Потом еще подумаю. 

Второе - фотографии отражений не изображаются. Займусь фотографиями.

### 20230520 13:52
Проболел целую неделю... Чувствую себя уже несколько лучше, хотя есть и проблемы. И голова болит после того, как часок подумаю. И кашель периодически наваливается. И, кажется, довольно сильная слабость. Ну да ладно, работать нужно. 

Сегодня я задумался об идее Филиппова - сделать хранилище докуменитов для нашего института. Вроде ничего не мешает, можно опреться на имеющийся решения. Не всегда эти решения технологичны, но ведь уже пользуемся. 

Какие документы будут передаваться в электронный архив? Думаю, что это могут быть внутренние и внешние приказы и распоряжения/постановления и т.д. Это могут быть инструктивные и учебные материалы. Типовым взаимодействием электронных документов с информационной средой ИСИ (экосистема?), видится использование в ссылках на сайте. А сайт тогда будет большим интегратором документного контента. Как сделать формирование документного архива естественнным? 

Для этого надо бы создать удобную технологию помещения и систему административных ограничений/рекомендаций. Но это - потом. Главное, организовать союственно технологию. В постановке отдельных документов, на первую роль выходят средства управления документным контентом. 

Заодно снова почитал про микросервисную архитектуру. В принципе - понятно. Только непонятно как реализуется основное совойство независимости развертывания. Например, при использовании middleware. Хотя там инъекции и вызовы (Singlet?) делаются с указанием инрефейса. Может это путь к независимости?

Но главное, я не понял как комплексировать решения на разных языках и платформах? 

### 20230525 10:01
Буду делать попытки продвинуться в проекте. Для начала, надо просто доделать презентационный интерфейс. Кажется, ключевым там является портрет 200x200 для персоны. А может, и не только для персоны. 

### 20230603 10:26
Вот и лето наступило!..

У меня есть важные дела. Это написать три отзыва на работы студентов и одну рецензию. Еще надо позвонить Платонову. Начну с этого. Позвонил. Теперь - приступаю к написанию рецензии. 

### 20230604 16:02
2 отзыва написал, одну рецензию написал еще вчера. Остался отзыва на Александрова. Вроде не срочно. Также я доделал одну модификацию. Дело в том, что работу с именованием я конкретно загнал аж в Polar.DB, класс USequence. Вытащил иенование оттуда в адаптер  UpiAdapter. Вроде работает...


