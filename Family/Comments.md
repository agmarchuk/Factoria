Комментарии к информационной системе Family

Как это должно выглядеть? Начальная страница может что-то объяснять, а может сразу давать выход на 
ресурсы, напр. на коллекции. Можно сделать так, что при отсутствии идентификатора, интерфейс приложения 
содержит информацию о том, что это за информационная система и как ей пользоваться.  

В общем, пока буду исходить из такой стратегии: если нет точки входа, то распечатывается некоторый текст.
Если есть точка входа, то она формирует начальный экран. Попробую это сделать. 

### 20230405 09:19
Попробую более регулярно поработать над дизайном семейного сайта. Посмотрю в каком он состоянии.

Первая проблема: при внешнем включении режима view, селектор выбора режима не переключается.  

Очень много времени потратил на поиск ошибки в построении генеалогического дерева. Даже пришлось 
восстанавливать старый вариант из репозитория. Теперь двинусь дальше. 

Делаю даты. Надо бы найти функцию, которую я уже писал. 

### 20230408 09:09
Дело застопорилось. Получилась какая-то inline композиция, но неполная... В общем, я запутался в
иерерхическом построении. Для преодоления, хочу сделать новый табличный визуализатор. Потом его можно
будет переделать в строчный. 

Итак, нам хочется построить портрет по идентификатору (а может и по записи). Будем делать портрет в 
компоненте типа BuildTablePortrait. В нем мы построим или возмем дерево Rec и отдельные части этого дерева
будем строить компонентом BuildTable. Возможно, будет иметь смысл выделить построение отдельного рядка. Но 
это - потом. 

Я увлекся вопросами устройства Asp.net, снова кое-что понял. Теперь идея заключается в 
том, чтобы собрать новую версию какого-то интерфейса под минимальным API и, может быть
через XML. Мне интересно это с двух позиций: во-первых, насколько это будет трудоемко и 
наглядно и, во-вторых, какая будет производительность решения. Есть ощущение, что 
razor-трансляция дорого обходится. Надо посмотреть...

### 20230409 08:57
Я все же начал проект. Потихоньку разбираюсь в "хитростях". Сначала искал способ получения 
аргументов (параметров) для построения страницы, нашел. Потом искал как выдать именно 
HTML-страницу, а не текстовую (явно не говорится о content-type). Также нашел. Потом 
увидел, что при создании приложения не появилась папка wwwroot. Посмотрел где она проявляется, 
понял, что никакими параметрами запуска она обычно определяется, посто завел "вручную",
папка появилась и в параметрах билдера. Наверное еще надо будет указать прямое использование
файлов из этой папки. Но пока двинусь дальше. 

Следующий шаг - придумать как грамотно оформлять отдельные страницы. Теоретически, можно 
сделать что-то вроде:
```
app.MapGet("/", Page1Delegate);
app.MapGet("/view/{id}", Page2Delegate);
app.MapGet("/edit/{id}", Page3Delegate);
...
Func<HttpRequest, HtmlResult> Page1Deledate = request => { ... }
```
Причем определение делегатов можно разнести по файлам через статические определения, 
погруженные в разные классы. Надо бы попробовать. Некоторая проблема заключается в том, что 
в делегат надо будет передавать разные наборы параметров. 

Вроде получилось нормально. И не требуется выделать id в параметрах делегата. Написал:
```
class ForDelegates
{
    public static HtmlResult Page1Delegate(HttpRequest request)
    {
        return new HtmlResult(new XElement("h1", "Empty work page").ToString());
    }
    public static HtmlResult Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        return new HtmlResult(new XElement("h1", "Empty work page: " + toprint).ToString());
    }
}
```

Следующий момент - использование потока вывода, нужно или нет - трудно сказать, но надо 
попробовать. 

Вроде получается... Код:
```
    public static void Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        request.HttpContext.Response.WriteAsync(toprint).Wait();
    }
```
Результат асинхронно "гонится" в поток вывода. Думаю, что пока это не актуально.

Вернемся к описанию делегатов. Надо постмотреть нельзя ли применить технику "страниц". 
Не придумал, хотя наверняка есть. В документации по минимальному API одна из рекомендаций
- именно тот вариант со статическими функциями, который я указал. 

Есть более интересный момент для попробования. Это получение сервисов. Попробую. Начну с
сервиса данных - он "потрясет" ситуацию по директориям и файлам. 

Сработало. Добавил в wwwroot файл с конфигуратором и файл с онтологией и все получилось. 
Только в параметры хендлера надо было добавить еще параметр с базой данных.

Что-то "бзикнула" идея по поводу того, что можно запускать неподготовленные для Web 
консольные приложения. Попробовал, не получилось, не очень то и хотелось...

Продолжаю. Теперь сервис базы данных есть. Сделаю верхнюю полоску, в которую потом помещу
поиск и авторизацию. Хотя авторизация может замедлить. А может и не замедлить...

Верхняя полоска. Сначала надо попробовать послать запрос от формы и принять его.
Посылаю две строки login и password. Потом пробую принять. Про полоску пока не думаю.

В общем, похоже, я "приплыл". Много времени потратил, чтобы запустить аутентификационный сервис,
но как-то не получилось... Возможно, есть способ интеграции двух подходов, возможно, это ничего 
не даст... А идея была, что razor-интерпретация требует ресурсов и времени. И что в это месте
можно ускориться. Как можно интегрировать разные подходы? Кажется, что при посылке реквеста на
обработку в зависимости от "карт", что-нибудь вроде:
```
app.MapGet("/view/{id}", ForDelegates.Page2Delegate);
```
И вот этот обработчик может без всякого razor/blazor построить новую страницу. Может быть, может быть...

Все же пора сделать что-то полезное. Я делал вьюер и хотел сделать табличный вьюер. Попробую вернуться 
к тому месту. 

### 20230411 12:52
Оказалось, что я не аккуратно сделал создание Rec-деревьев. Отсутствовали неиспользованные 
"веточки"-свойства. А это фатально для редактирования. Сейчас сделал изменения, получил нужную картинку.

В принципе, я могу и редактированием заняться и визуализацией. Но первая задача - ограничивать "видимость"
через шаблон. Как это сделать? Можно запрещать использовать классы, можно запрещать использовать свойства. 
Возможно, свойства - более эффективно. Простая схема ограничений будет работать, если будет работать 
редактирование базы данных с помощью "усеченных" записей. Это надо проверить. Кажется, я предпринимал для 
этого определенные усилия. 

У меня в голове есть определенная модель рестрикций. Я просто сделаю набор свойств, которые запрещены. 
Причем можно сделать симметричный запрет, когда объектные свойства запрещены в обеих направлениях, а можно 
сделать и несимметричный. Кажется, второе полезнее. Почему я так думаю, дело в том, что по практике 
предыдущих решений, система запретов позволяет к некоторым свойствам подходить только с одной стороны. 
Кажется...

Но есть еще первичные ограничения. В прошлый раз я делал их через темы: семья и др. Кстати, мо

### 20230413 
Я застрял на размышлениях по поводу возможности использования ограничений в древовидном построении.
Проблема заключается в том, что отредактированное значение надо записывать в базу данных. Но при этом, 
нельзя потерять информацию, которую возможно мы не использовали. Похоже, ограничения - это для вьюера. 
При выборе данного для редактирования, нужна вся запись. Попробую.

### 20230414 10:28
Я пытаюсь собрать более или менее приемлемую версию фамильного сайта. Идет медленно, но идет...

Сейчас постараюсь придумать какое-то более радостное оформление. Посмотрю фотографии. Какие могут быть 
идеи? Это может быть композиция из медалей, это может быть композиция из фамилий. Удачная фотография, 
может старая. Посмотрю фотографии и документы. 

### 20230415 15:30
Я доделал разработки режимов gene/edit/view, сделал новое оформление, закоммитил и запушил. Теперь хочу 
вернуться к идеям интерфейса look, в которых я пытался сделать ставку на "шахматку" из композиций. Теперь
у меня есть управляемое построение дерева Rec, соответственно следующий уровень Rec делается в виде
синтезируемой композиции (иконки) прямоугольного размера. 

Пока не начал, надо исправить выдачу прямой ссылки в представлении view. А то там нет ссылок, нет 
картинок. 

### 20230416 16:20
Постоянно "натыкаюсь" на проблемы, которые долго преодолеваю. Вот преодолел проблему в выводе документов.
А надо было поставить:
```
app.MapControllerRoute(name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}");
```

Интересно, что я недавно уже преодолевал эту проблему. Даже не проблему, а недогляд... 4 апреля, я Трошкову про это 
писал. Удивительно как быстро забывается...

Возвращаюсь к первой странице. Даже не первой, а view-странице. Буду делать страницу /view, а потом страницу 
/view/

### 20230417 16:28
Попробую сделать хоть немного. Это будет в режиме look. Беру идентификатор, нахожу RRecord, выделяю 
тип. В зависимости от типа, строю shablon. По шаблону строю Inline-композицию, но без чего-то главного.

### 20230418 11:58
Меня корреспонденка попросила сделать видимость работы. Вот делаю. На самом деле, мы с Трошковым во-многом
застряли. И у меня нет целостной картины использования Rec'ов и у него. 

Пожалуй попробую немного поработать. Идея заключается в том, чтобы какую-то часть информационного портрета
изображать inline, а другую каким-то композиционным способом. Попробую это сделать с коллекцией. 
Шаблон для нее я уже набросал

### 20230422 13:16
Была очень напряженая неделя и я не смог поработать над проектом. Появились некторые точки останова, которые 
попробую сформулировать. Во-первых, у меня нет ясности в том, как пользовать языковыми вариантами. Особенно, 
при редактировании данных. Идея заключается в том, чтобы многоязыковые поля изображались парой выбор языка - 
значение поля. При вводе такого языка может не оказаться, поэтому должна быть команда добавления языка.

Вторая точка останова заключается в принципах построения view-композиций на основе Rec-дерева. Третья точка - 
управление набором используемых отношений. Четверная точка - продумать использование фактографической системы 
для поодержания научного делопроизводства в ИСИ. Вроде много чего есть, но удобной технологии нет. 

Главное, что я застрял на оформлении первых страниц сайта. Попробую сделать это по-старинке. Я уже выделил объект коллекции, даже сделал начальный шаблон. Теперь разрисую этот объект. 

### 20230425 10:40
Сегодня и завтра я еще буду дома. Пости все дела уже отложены, можно поработать над проектом. Попробую
настроиться и не предрываться. Делаю Look-интерфейсы. Начал со странички оформления коллекции. Потом буду 
делать другие страницы, включая малые (200x200- композиции).

### 20230501 12:25
Вот мы уже четыре дня на Семинском перевале, в УТЦ. Погода практически зимняя, снегу навалом, куда-то пойти пролематично. С утра был неплохой морозец и образовался наст по которому, кажется, можно передвигаться. Предыдущие дни я работал над проектом "Заяц", который хочу подготовить к следующей ЛШЮП. Этот проект я готовлю с Мишей Ноговициным. Вроде что хотел - сделал. Пусть теперь Миша разбирается, а я могу заняться фактографичкими проектами. 

С некоторыми трудностями, удалось запустить проект на ноутбуке, который я взял с собой. "Поигрался" с данными, вроде все нормально. 

Что-то мне не нравится технология замены базы данных. Надо бы делать это не ручным очищением файлов, а по команде. Это делается в сервисе базы данных. Попробую...

#### 20230507 05:49
Презентационный интерфейс уже "задышал". Но надо выправить детали. Пообсуждаю.

В принципе, я могу управлять набором и порядком полей, прямых отношений и обратных отношений. Также глубиной раскрытия этих отношений. Но пока я работаю с универсальными раскрытиями. А потом предполагаю, что будут специализированные. Специализированные обязательно должны присутствовать поскольку требуется дополнительная информация к "маленьким" портретам. Для фотодокументов важна не только время съемки, но и место, а это уже требует дополнительного анализа отношения "отражение". С портретами персон - приблизительно также. Нужно найти портрет. 

Можно не пытаться построить все дерево сразу. А строить некоторую основу, а в ней заполнять информацию по имеющемуся типу отношения и типу объекта. Наверное, это можно регулировать двумя уровнями раскрытия: "большой" портрет и "маленький". У меня все это есть. Надо поработать над "маленьким". В принципе, есть еще inline-портрет, который используется в обычных отношениях. К таким отношениям относятся титулы и награды. Хотя и фотки медалей были бы уместны. Но куда их разместить? Отражение может быть? 

Я подумал, похоже надо добавить в отношение reflection ссылку на документ, свидетельствующий о титуле. Это может быть и фотодокумент и скан грамоты, диплома и т.д. Да и многостраничнфый документ тоже подойдет. Но это - потом. Сейчас важно сделать маленькие портреты персон. Сверху пишем "Персона", потом идет фотография, если есть, потом имя, потом даты жизни. Вместо "персона" можно и квалифицировать "отец" и т.д. На фотографию навешаем ссылку и выплывающую подсказку, куда поместим титулы, места работы. 

### 20230512 11:53
Пытаюсь настроиться на работу. Начну с исправления неприятности, свзязанной с ненахождением документа для внесения редактирования. Во-первых, надо постараться зафиксировать ситуацию при входе в режим редактирования, во-вторых, надо корректно отреагировать на ситуацию когда/если она возникнет.

Ситуация возникает когда или нет документа для редактирования этим оператором или документ не проставлен на запись. Создам тестовую ситуацию. 

### 20230513 09:38
Вчера все же сделал некоторое исправление. Хотя и не в полном объеме. 
Сделал проверку на наличие возможности вести запись под конкрентым именем пользователя.
Остались еще другие потенциальные проблемы в динамике работы с данными, вызывающие
прерывание, но пока можно оставить так как есть. Это потому, что я не придумал
общую схему или перехвата прерываний или аккуратного сопровождения ошибок. Но пока - все по этому вопросу.

С новыми силами займусь фамильным архивом. Что-то уже начало получаться, надо посмотреть
и выработать направления работы. 

Начал с персоны. Как-то пока не очень... В чем вопросы? 1-е - списки могут быть большими.
Хорошо бы сделать список, который "разворачивается". Хорошо бы сделать список на три положения. 
Напр. начальное положение - просто количество элементов в списке. Промежуточное положение - 
штуки четыре элемента. Полное раскрытие - весь список. Только нужно отказаться от 
разделения на заголовок и сам список. Еще хорошо бы иметь и четверное положение. 
Потом еще подумаю. 

Второе - фотографии отражений не изображаются. Займусь фотографиями.

### 20230520 13:52
Проболел целую неделю... Чувствую себя уже несколько лучше, хотя есть и проблемы. И голова болит после того, как часок подумаю. И кашель периодически наваливается. И, кажется, довольно сильная слабость. Ну да ладно, работать нужно. 

Сегодня я задумался об идее Филиппова - сделать хранилище докуменитов для нашего института. Вроде ничего не мешает, можно опреться на имеющийся решения. Не всегда эти решения технологичны, но ведь уже пользуемся. 

Какие документы будут передаваться в электронный архив? Думаю, что это могут быть внутренние и внешние приказы и распоряжения/постановления и т.д. Это могут быть инструктивные и учебные материалы. Типовым взаимодействием электронных документов с информационной средой ИСИ (экосистема?), видится использование в ссылках на сайте. А сайт тогда будет большим интегратором документного контента. Как сделать формирование документного архива естественнным? 

Для этого надо бы создать удобную технологию помещения и систему административных ограничений/рекомендаций. Но это - потом. Главное, организовать союственно технологию. В постановке отдельных документов, на первую роль выходят средства управления документным контентом. 

Заодно снова почитал про микросервисную архитектуру. В принципе - понятно. Только непонятно как реализуется основное совойство независимости развертывания. Например, при использовании middleware. Хотя там инъекции и вызовы (Singlet?) делаются с указанием инрефейса. Может это путь к независимости?

Но главное, я не понял как комплексировать решения на разных языках и платформах? 

### 20230525 10:01
Буду делать попытки продвинуться в проекте. Для начала, надо просто доделать презентационный интерфейс. Кажется, ключевым там является портрет 200x200 для персоны. А может, и не только для персоны. 

### 20230603 10:26
Вот и лето наступило!..

У меня есть важные дела. Это написать три отзыва на работы студентов и одну рецензию. Еще надо позвонить Платонову. Начну с этого. Позвонил. Теперь - приступаю к написанию рецензии. 

### 20230604 16:02

2 отзыва написал, одну рецензию написал еще вчера. Остался отзыва на Александрова. Вроде не срочно. Также я доделал одну модификацию. Дело в том, что работу с именованием я конкретно загнал аж в Polar.DB, класс USequence. Вытащил иенование оттуда в адаптер  UpiAdapter. Вроде работает...

### 20230609 08:31

Наконец, приближается время, свободное от обязанностей. Может сегодня смогу начать. А потом, суббота, воскресенье, праздник. Надо бы качественно использовать эти возможности. 

Я, в очередной раз заинтересовался Material Design почитал, попробовал. В общем, пользоваться можно, хотя уменья использовать CSS и JavaScript у меня не хватает. Второй момент из прошедшего заключается в том, что при испытаниях, сайт Family порождает "тонкую" ошибку типа "System.Security.Cryptography.CryptographicException: The key {4cb3a490-cc83-43ee-a1ec-0c64b139ca6f} was not found in the key ring". И порождается она где-то в "Family.Components.Info.GetStateAsync()". Причем интересно, что эта ошибка имеется только (не уверен...) при применении браузера Microsoft Edge. Надо поразбираться, но кажется это из-за применения состояния Session. А нужно ли применять эту сессию? У меня состояние для чего используется? Для фиксации зарегистированного пользователя, для фиксации применяемого интерфейса. Причем пользователя надо фиксировать только при редактировании, а интерфейс может (и должен!) фиксироваться применяемым контроллером. Есть еще одна мечта: дать настройки пользователю и сохранять их в сессии. 

Думаю, что решение должно быть комплексным. Во-первых, там где возможно, устранить состояние и сессию. Хорошо бы аутентификацию сделать без внешней сессии, вроде такая возможность рассматриватеся как базовая. Там, где без сессии нельзя, надо попробовать другие варианты ее реализации, вплоть до сессии в адресной строке. Например, через второй параметр в адресной цепочке Controller/Action/id/session. Надо научиться кодировать и декодировать объекты. 

Как-то так...

Алексей Фурсенко просигналил, что перестал работатб Урсул на машине Сергея Лештаева. Это - удар "в поддых"! Там такая старая технология, что трудно подобраться. Возможно, проблема простая, но я не нашел где она скрывается. Решил пока позаниматься переписыванием интерфейса Ursul на новые средства. Ну хотя бы попробую...

Сначала в решении Factoria заведу новый Blazor-проект Publika и попробую начать воспроизводить по текстам Урсула. 

### 20230610 09:33
Идея адаптировать код Publicuem/Ursul в новую среду, потерпела сокрушительное поражение. Там так много всего того, чем я уже не пользуюсь, там так много мест, которые сразу не понять! Попробую зайти с другой стороны. Попробую сформировать похожее решение из  того, что есть. И еще в дизайне Material Design. И еще с минимизацией всяких там "трюков". 

Что я делаю? Сначала формирую проект, назову его Publicia. Сделаю в Блазоре. Менюшку Блазора пока оставлю. В меню буду помещать и действия и настройки. Следующий шаг - активация сервисов. Попробую обойтись без сессии. Можно же обслуживать состояние пользователя через базу данных. Начинаю работу. 

### 20230612 10:08
День России! 

Работа идет очень медленно, но идет. Я собираю редактор из того, что есть, убираю лишнее и иногда добавляю то, чего не хватает. Сейчас я сделал формирование главной таблицы, занялся формированием обратных таблиц. Там есть место, которое меня регулярно беспокоит: а много ли типов обратных таблиц? Я Inv сделал в расчете на "много", но в онтологии - их только один тип для каждого обратного отношения. А может и не один... Рассмотрим отношение отражения. Там и в сторону субъекта и в сторону документа - вариантов много. С другой стороны, мы со стороны персоны как субъекта по предикату reflected попадаем именно в reflection. А вот уже из него попадаем в разные виды документов. 

Вопрос, могу ли я по заданному предикату вычислить тип источника и строить таблицу из этого типа? Кажется - могу. И даже кажется шиблон делает это вместо меня. Поэтому берем все Inv одного предиката и берем первый их них как шаблон. Надо попробовать.

Ура! Программа заработала в запланированном ограниченном объеме. Теперь надо сообразить как ею управлять. И реализовать это. 

Посмотрел как получилось и решил, что для обратных отношений будеть лучше использовать древовидное построение. В MatBlazor есть TreeView. Попробую его запустить. 

Попробовал, запускается, но не совсем то, что мне нужно. Изучаю другие компоненты. Вроде MatExpensionPanel тоже подходит. По крайней мере, там один этаж расширения. Правда эти два этажа бедноваты в информационном смысле и в смысле оформления. 

### 20230616 09:44
Прошли тяжелые дни ГЭКа в НГТУ, потом прошел день релаксации. Следующие большие "дела" будут с понедельника, это ГЭК Мехмата. Придется выдержать целую рабочую неделю... 

А сегодня надо бы вернуться к позитивной работе. Начну с того, что сформулирую анонс мастерской и пошлю Тихоновой. 

Анонс сделал. А теперь что делать? Я закончил на попытке сделать "чистое" редактирование. ПОка получается "чистая" визуализацию. Надо посмотреть что получилось и как это продолжить. 

### 20230617 16:27
За вчера я только почти полностью отказался от MatBlazor. По крайней мере, код стал прозрачнее. А украшательства примененные элементы не давали. Кроме навигации, оставил только class="mat-elevation-z5" для таблиц. Выделение, которое не раздражает. Что нужно сделать еще?

Во-первых, надо доделать разные режимы визуализации. Куда сохранять параметры? 

Смотрел, смотрел и так и не понял. Решил временно разместить параметры прямо в Edit.razor. Пока...
Главное, зафиксировать это состояние приложения или сессии. Потом буду разираться куда его сохранять. 

Первое поле bool toedit которое истино когда можно редактировать. Если нельзя, то имеется режим визуализации.

### 20230618 10:07
Вчера сделал убирание пустых обрантых списков. Сегодня хочу заняться списками (фото) документов. 

В чем проблема? Хочется сохранить общую схему формирования обратных отношений. Однако, в случает списков документов (и не только), иметь возможность переключаться на формат набора "карточек". Проблема в том, что хорошо бы иметь динамический триггер, который переключать в динамике просмотра. 

Ура! Меня зарегистрировали в списке мастерских. Кроме того, я снова поизучал Питон. А также, написал идею решения в виде текста с (сомнительным) рисунком. 

### 20230626 13:11
Надо упорядочить подготовку к мастерской. Я уже раньше решил, что надо сделать учебное пособие в технологии MD. По-моему, неплохая идея. Я буду делать отдельные уроки и заполнять приложения со справочной информацией. Кстати, уменье пользоваться MD вполне может стать частью учебы, а его использование - частью проекта в части отчета и докуменации. 

### 20230702 10:01
Сегодня последний день подготовки к ЛШЮП. Еще много чего не сделано, надо бы поработать по-максимуму. План такой: 
- написать отчет о выполнении госзадания
- подготовить созданные материалы к использованию
- сделать продвижение в универсальном редакторе
- постараться опубликовать текущую версию syp

Начну с первого пункта. Ура, выполнил достаточно быстро. Перейду к выполнению второго. Собственно, матералы есть в директории на моем рабочем компьютере. Надо сдублировать текущую версию на флешку. Сдублировал, теперь не забыть бы взять с собой.

Займусь продвижением в проект SypBlazor. Он уже кое-что может, но еще надо доделывать. 

Что сразу бросается в глаза:
- Дизайн "от фонаря", надо привести в соответствие
- Воспроизводить документы
- перейти на wrap-набор айтемов в списках документов

Начну, пожалуй. 

Дизайн я пока пропустил, работаю над воспроизведением документов. В портретном виде, докуменнты (фото-видео=pdf) уже воспроизводятся. Теперь в отражениях и коллекциях. 

Пополняю список необходимых доработок. 
*- исключить из визуализации uri и docmetainfo
- авторизация
- перезагрузка
- потом переход в режим редактирования и обратно.

### 20230709 18:52
Прошла ровно неделя со для последней записи. Это и понятно, сил хватало только на школьников... Теперь сил хватило на то, чтобы немного разобраться в стилевом оформлении Блазор-решений. Выяснилось в частности то, что осноные настройки делаются не через Material Design, а через Бутстрап. Сайт [https://getbootstrap.com/docs/5.0/components/navbar/?#nav] позволиь кое-что понять в настройках панели и меню. 

В итоге, я попробовал собрать новый интерфейс для своих решений. Не все у меня получилось, но попробую довести до использования. Чтобы доводить надо собрать все, что нужно в едином дистрибутиве. А он у меня теперь 

### 20230715 17:09
Кое-что доделал по сайту ЛШЮП. Что не доделано?

1) Перезагрузка данных
2) Не всегда работает "след.-пред."
3) Что-то я намудрил с видео-фрагментом с чужой презентацией мастерской. 
4) надо бы сделать разрыв после поиска

### 20230718 10:35
Вчера хоронили Годунова, уходят великие...

Однако, надо работать! Сейчас главным выглядит редактирование. Попробую аккуратно перенести работающее редактирование 
в новую форму SypBlazor. Сначала надо зафиксировать предыдущие изменения в репозитории, потом начну творить. 

Я перевел ссылку на Polar.DB в Nuget вариант. Вроде работает на моих компьютерах. Теперь двинусь дальше. Для начала, нужно сделать надежно регистрацию и авторизацию. 

Первая проблема в том, что панель меню не сворачивается при нажатии на команду. Попробую что-нибудь сделать. 

Наполавину сделал, пока достаточно. Теперь надо воспроизвести перезагрузку. 

### 20230720 02:06
Вот, решил поработать ночью. Хотя бы немного... 

Перезагрузку я сделал, сделал еще небольшие оформительские мелочи. Подкрадываюсь к собственно редактированию. Для начала, полежно ввести какой-то признак редактируемости. Например, bool toedit. Вопрос - куда его поместить? Может в пользователя? 

Пока наверное буду формировать признак в самом главном шаблоне MainLayout и "протягивать" его по необходимости.

Еще одно соображение периодически проиходит на ум. Хорошо бы все настройки приложения перенести в настроечный файл appsettings.json

Пока сделал тестовую кассету test2 для проверок редактирования. 

15:00

Первая часть редактирования, создание объекта уже работает. Теперь можно сделать уничтожение. 

### 20230721 09:26
Сделал уничтожение. Вроде в обоих режимах и редактируемого айтема и обратного отношения. Осталось сделать проверку на то, что айтем не имеет ведущих в него ссылок.

Теперь надо сделать еще появление нового отношения и можно будет приступать к редактированию айтема. 

Надо проверить правильность "Пупкин Вас вас"\находится в/ место или тип размещения. Проверил, это ошибка в данных.

Теперь займусь новым отношением. Первый "наскок" ничего не дал поскольку не высвечиваются отношения, которые не используются. Надо поискать где что пропадает.

### 20230723 06:00
Потихоньку двигаюсь вперед. Уже виден "горизонт", к которому стремлюсь, хотя это уходящая линия...

Переписываются другом семьи Беляева Владимира Георгиевича Богатых Петром Дмитриевичем (он пишет Пётр). Собрал много полезной информации о ВГ и его семье, прислал и фотки. 
Все это стимулирует меня к тому, чтобы делать (ДЕЛАТЬ!) семейный сайт. Сейчас создаю ключевую "деталь": окно редактирования записи. Хочу хотя бы здесь, сделать многоязыковость.
Вперед!

### 20230724 10:53
Я застрял на вводе/редактировании многоязыковых текстов. Проблем две: 1) конструкция языкового переключателя; 2) прикрепление 
ввода к конкретному текстовому полю. Буду рассуждать. Допустим, мы не стремимся в вводу новых языковых значений. Только редактирование.
Тогда логичен binding к Value какого-то TextLan. Допустим, при формировании html, мы берем массив этих языковых значений и делаем binding 
только на одно из них (напр. ru). Но если мы захотим изменить язык редактирования, то поменять привязку будет довольно трудно. 

### 20230725 09:45
Я совсем запутался в логике редактирования. Кажется, это из-за того, что я сделал ставку на Binding. Надо попробовать сформировать 
эту самую логику через обычные события по изменению данных. 

Итак, начну с языков. Сначала делаю комбо-бокс с набором имеющихся для Tex языков, если языков пока нет, устанавливаю русский.
Соответственно, пишу реакцию на изменение языка. 

Сейчас углубленно подумал и решил, что и в этом варианте есть проблема. Не места для хранения текущего состояния. Какой язык 
установлен? Может по комбо-боксу можно установить? Попробую сделать эксперимент.

### 20230726 09:50
Все "мучаюсь" в попытках решить задачу редактирования текстового поля (позор!!!). Снова попробую
порассуждать. 

Мне не хватает поля для фиксации текущего или последнего языка для именно этого поля. 
Попробую обойтись без него. Нарисовал варианты языка, нарисовал отображение одного поля на 
конкретный индекс массива языковых вариантов. Может и не на индекс, а на само значение. Так легче 
делать binding. Если меняется значение поля значения (тьфу - тавтология), то байндинг это решит.
Если меняется вариант языка, то 1) надо (бы) изменить байндинг на другой языковый вариант. А как
это сделать? Не знаю... Пришла в головую идея, вроде не нарушающая предыдущих построений. 
Идея заключается в том, чтобы среди вариантов иметь вариант current:lang. Его и прикреплять к
полю тектового ввода. Тогда при смене варианта, мы записываем накопленное значение по языковой 
принадлежности, а из другого языкового варианта переписываем то, что нужно. В конце делаем 
это же, но без нового текущего. Попробую...

Но можно и проще. Информацию о текущем языке и текущее значение поля можно собрать в специальный
массив. Это вроде даже проще. 

### 20230728 15:00
Потихоньку дело движется... Уже что-то работает, но целостного редактирования пока нет. 

Проверяю что я уже сделал. Пока не работает ввод текста, если его еще не было. Посмотрю где это подправить.
Там не совсем понятно как правильнее оргинизовать это ввод. Попробую такую идею: если совсем ничего нет,
то путь будет пустой язык. Если язык устанавливается, то одновременно задать пустую строку текстового
значения. Если переустанавливается, то также задать. Текст при ок либо зафиксируется в RDF, либо
исчезнет если получилась пустая строка. 

### 20230729 07:30
Застрял на казалось бы простой задаче: как управлять парой язык - значение при текстовом вводе-редактировании.
Видимо я не сформировал правильного состояния и изменений этого состояния. Еще раз смотрю на то, что получилось, 
вроде не все так плохо. Если хотя бы одно значение есть, то какое-то из двух появляется в поле ввода/редактирования. 
Если нет ни одного, то не визуализируется и поле. Тогда при установке языка можно сгенерировать и значение и
поле ввода. Но это уже надо обрабатывать события, чего я пока не делал. Начну с ввода комментария.

Вроде получилось, теперь первично все виды полей обрабатываются. Только не все имеют адекватные хендлеры обработки событий.
Теперь попробую сделать реакцию на две главных кнопки: ok и cancel. Реакция на них должна выполняться где-то
снаружи. Так что нужны EventCallback'и. Начну с отмены. Вроде ничего не нужно делать, только завершить (закрыть)
компонент. 

Получилось. И даже StateHasChanged() не понадобился... Теперь поработаю над ok. Надо получить сформированный объект,
сделать из него XML-запись и сохранить. Кстати, "таскать" полное дерево может и не надо или не надо таскать
"обратно". По крайней мере, можно из дерева исключить обратные свойства (отношения). Попробую все сделать "напрямую", 
через объектное представление Rec и ...

Вроде работает. Надо еще сделат уничтожение прямой ссылки, потом начну встраивать в портрет. 

Все вроде нормально, но есть проблемы. Во-первых, нет опции нов. на приямых ссылках. Во вторых, кажется, 
после уничтожения ссылка какое-то время продолжает оставаться старой. Посмотрю.

Выявляю оишбки. Во-первых, при создании прямой ссылки, происхожит переход по этой ссылке. Во-вторых,
эта связь так и не фиксируется. Поищую. 

### 20230730 08:30
День военно-морского флота России! Надо ознаменовать его новыми победами на "полях" фактографии...

Вчера кое-что стало получаться. Сегодня добилса подсоединения записи по прямому полю к другой, существующей.
Но при нажатии на "крестик" разрушения такой связи, имеется неточность: связь физически разрушается, но в 
редактируемой таблице остается. Поищу...

Я "подкрался" к важному и похоже новому в реализации моменту. Это хендлеры по реакции на нажатие нов.
Я понял, что это нажатие может выполнить два действия: создать новую запись и прикрепить эту запись к фокусной записи.
Тут главный вопрос несолько в другом: как избавиться от побочного эффекта? Действительно, фиксация записи -
это понятное заключительное действие по редактированию. Но если перед этим будет создана новая запись или
изменена какая-то существующая, то это нарушение "чистоты" процесса редактирования. Собственно создание 
новой записи, на которую потом устанавливается ссылка, и порождает побочный эффект. Если делать с побочным эффектом,
то отработка нажатия "нов." должна приводить к двум действиям: первое - реальное создание записи по типу и
образцу; второе - формирование прямой Dir-ссылки в которую записываются данные (идентификатор) ранее созданной 
записи. Выглядит не очень, то так редактор ранее и работал. Сделаю как раньше, а то опять "закопаюсь".

Вроде получилось! Теперь надо внедрить решение в построение портрета.

Внедрил, работает. Пока явных проблем не видно. Надо произвести комплексное тестирование. Для этого надо выполнить 
реальную информационную работу. У меня как раз есть материалы от Петра Богатых.

### 20230731 06:35
Сделал кассету bogatykh, теперь начинаю наполнять базу данных. Буду вести список
пожеланий и замечаний:
1) надо плоские txt-файлы прямо визуализировать
2) В таблице редактора не нужно редактировать uri и docmetainfo
3) В кассете (в коллекции) не надо демонстирировать fog-файлы
4*) Какая-то непонятная ошибка при переходе от Беляева ВГ к жене Раисе. Попробую найти. Нашел, исправил.
5) Надо у детей в портрете персон сделать гиперссылку.
6) Опять после ликвидации прямой ссылки, не сразу обновляется запись. 

Действительно, создание сложного отношения не получается. Точнее, получается "наполовину". Скажем,
я создаю семью от Пупкина, заполняю супругу Серафима, а потом выясняется, что Серафима за мужем,
не неизвестно за кем, а у пупкина обратное отношение не прикрепляется. Я уже много описал данных,
но в них много этого самого брака. 

После изучения и многочисленных экспериментов выявилось, что в обратных отношениях при фиксации теряется связь с фокусным объектом.
Что надо делать? Надо формировать обратную запись во всех деталях по онтологии. Но прямое отношение, соответствующее тому, по
которому мы туда (обратно) приходим, просто не надо визуализировать в форме редактирования. А потом все, что есть в этой записи 
зафиксировать. 

Было бы здорово, но передаваемые Rec и Tree этих (ненужных!..) свойств. Надо посмотреть как я решал эту проблему ранее в редакторе. 

### 20230802 09:00
Начался агуст! Сегодня - день ВДВ!

Ночью "добил" проблему предыдущих дней. Теперь редактор работает. Не буду слишком сильно радоваться, буду проверять!
Придется переделать работу над архивом Петра Богатых. Ну да ладно, сам виноват...

Сейчас довольно быстро проставил отраженного ВГ и фотографиях. И пару авторизаций. Безусловно неудобным является то,
что после нажатий, как правило, картинка прыгает на начало и надо находить мето работы. Также хотелось бы, что при нажатии нового 
обратного отношения, новая запись сразу раскрывалась для редактирования. Возможно можно эти две вещи совместить. Я никогда не управлял 
этими моментами, даже не знаю как это можно делать. Может попробовать сделать "два в одном"? Посмотрю, может попробую...

Итак, смотрю как отрабатывается нажатие на кнопку нов. 

### 20230803 14:54
Снова ночью "добил" проблему. Теперь у меня нажатие на "нов." в отношении, создает отношение и раскрывает 
его для редактирования. Удобно. И место не теряется. Пока немного "залипает" эта открытость. Выражается это
в том, что при новом выходе на таблицу, конкретная строчка может оказаться открытой. Надо будет снимать
признак открывания. 

### 20230804 16:06
Вроде все неплохо. Повторил, а потом закончил редактирование данных Петра Богатых. Есть небольшие неудобства.
Например, у детей нет гиперссылки на основном имени. Это неудобно, поскольку хочется "ходить" по семье 
достаточно унифицировано. 

Еще появилась туманная идея: как-то все запаковывать и посылать кому-то. Я бы Петру послал. Эта идея и раньше 
появлялась в варианте делания хорошо расписанной фотографии. А если это коллекция фотографий? Но как это сделать -
пока не знаю. Может приложение писать? 

### 20230805 03:00
Что-то не спится. В последнее время у меня неплохо получается поработать ночью, когда голова несколько 
отдохнет. 

Посмотрел список пожеланий. Вполне доступно для реализации. Главное - ссылки на детей. Это исключение,
надо его физически вставить. И по видимости/невидимости файлов тоже не должно быть слишком сложно. Сначала 
сделаю коммит, чтобы зафиксировать текущее состояние. 













