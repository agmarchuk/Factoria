Комментарии к информационной системе Family

Как это должно выглядеть? Начальная страница может что-то объяснять, а может сразу давать выход на 
ресурсы, напр. на коллекции. Можно сделать так, что при отсутствии идентификатора, интерфейс приложения 
содержит информацию о том, что это за информационная система и как ей пользоваться.  

В общем, пока буду исходить из такой стратегии: если нет точки входа, то распечатывается некоторый текст.
Если есть точка входа, то она формирует начальный экран. Попробую это сделать. 

### 20230405 09:19
Попробую более регулярно поработать над дизайном семейного сайта. Посмотрю в каком он состоянии.

Первая проблема: при внешнем включении режима view, селектор выбора режима не переключается.  

Очень много времени потратил на поиск ошибки в построении генеалогического дерева. Даже пришлось 
восстанавливать старый вариант из репозитория. Теперь двинусь дальше. 

Делаю даты. Надо бы найти функцию, которую я уже писал. 

### 20230408 09:09
Дело застопорилось. Получилась какая-то inline композиция, но неполная... В общем, я запутался в
иерерхическом построении. Для преодоления, хочу сделать новый табличный визуализатор. Потом его можно
будет переделать в строчный. 

Итак, нам хочется построить портрет по идентификатору (а может и по записи). Будем делать портрет в 
компоненте типа BuildTablePortrait. В нем мы построим или возмем дерево Rec и отдельные части этого дерева
будем строить компонентом BuildTable. Возможно, будет иметь смысл выделить построение отдельного рядка. Но 
это - потом. 

Я увлекся вопросами устройства Asp.net, снова кое-что понял. Теперь идея заключается в 
том, чтобы собрать новую версию какого-то интерфейса под минимальным API и, может быть
через XML. Мне интересно это с двух позиций: во-первых, насколько это будет трудоемко и 
наглядно и, во-вторых, какая будет производительность решения. Есть ощущение, что 
razor-трансляция дорого обходится. Надо посмотреть...

### 20230409 08:57
Я все же начал проект. Потихоньку разбираюсь в "хитростях". Сначала искал способ получения 
аргументов (параметров) для построения страницы, нашел. Потом искал как выдать именно 
HTML-страницу, а не текстовую (явно не говорится о content-type). Также нашел. Потом 
увидел, что при создании приложения не появилась папка wwwroot. Посмотрел где она проявляется, 
понял, что никакими параметрами запуска она обычно определяется, посто завел "вручную",
папка появилась и в параметрах билдера. Наверное еще надо будет указать прямое использование
файлов из этой папки. Но пока двинусь дальше. 

Следующий шаг - придумать как грамотно оформлять отдельные страницы. Теоретически, можно 
сделать что-то вроде:
```
app.MapGet("/", Page1Delegate);
app.MapGet("/view/{id}", Page2Delegate);
app.MapGet("/edit/{id}", Page3Delegate);
...
Func<HttpRequest, HtmlResult> Page1Deledate = request => { ... }
```
Причем определение делегатов можно разнести по файлам через статические определения, 
погруженные в разные классы. Надо бы попробовать. Некоторая проблема заключается в том, что 
в делегат надо будет передавать разные наборы параметров. 

Вроде получилось нормально. И не требуется выделать id в параметрах делегата. Написал:
```
class ForDelegates
{
    public static HtmlResult Page1Delegate(HttpRequest request)
    {
        return new HtmlResult(new XElement("h1", "Empty work page").ToString());
    }
    public static HtmlResult Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        return new HtmlResult(new XElement("h1", "Empty work page: " + toprint).ToString());
    }
}
```

Следующий момент - использование потока вывода, нужно или нет - трудно сказать, но надо 
попробовать. 

Вроде получается... Код:
```
    public static void Page2Delegate(HttpRequest request)
    {
        var id = request.RouteValues["id"];
        var page = request.Query["page"];
        string toprint = $"[{id}] [{page}]";
        request.HttpContext.Response.WriteAsync(toprint).Wait();
    }
```
Результат асинхронно "гонится" в поток вывода. Думаю, что пока это не актуально.

Вернемся к описанию делегатов. Надо постмотреть нельзя ли применить технику "страниц". 
Не придумал, хотя наверняка есть. В документации по минимальному API одна из рекомендаций
- именно тот вариант со статическими функциями, который я указал. 

Есть более интересный момент для попробования. Это получение сервисов. Попробую. Начну с
сервиса данных - он "потрясет" ситуацию по директориям и файлам. 

Сработало. Добавил в wwwroot файл с конфигуратором и файл с онтологией и все получилось. 
Только в параметры хендлера надо было добавить еще параметр с базой данных.

Что-то "бзикнула" идея по поводу того, что можно запускать неподготовленные для Web 
консольные приложения. Попробовал, не получилось, не очень то и хотелось...

Продолжаю. Теперь сервис базы данных есть. Сделаю верхнюю полоску, в которую потом помещу
поиск и авторизацию. Хотя авторизация может замедлить. А может и не замедлить...

Верхняя полоска. Сначала надо попробовать послать запрос от формы и принять его.
Посылаю две строки login и password. Потом пробую принять. Про полоску пока не думаю.

В общем, похоже, я "приплыл". Много времени потратил, чтобы запустить аутентификационный сервис,
но как-то не получилось... Возможно, есть способ интеграции двух подходов, возможно, это ничего 
не даст... А идея была, что razor-интерпретация требует ресурсов и времени. И что в это месте
можно ускориться. Как можно интегрировать разные подходы? Кажется, что при посылке реквеста на
обработку в зависимости от "карт", что-нибудь вроде:
```
app.MapGet("/view/{id}", ForDelegates.Page2Delegate);
```
И вот этот обработчик может без всякого razor/blazor построить новую страницу. Может быть, может быть...

Все же пора сделать что-то полезное. Я делал вьюер и хотел сделать табличный вьюер. Попробую вернуться 
к тому месту. 

### 20230411 12:52
Оказалось, что я не аккуратно сделал создание Rec-деревьев. Отсутствовали неиспользованные 
"веточки"-свойства. А это фатально для редактирования. Сейчас сделал изменения, получил нужную картинку.

В принципе, я могу и редактированием заняться и визуализацией. Но первая задача - ограничивать "видимость"
через шаблон. Как это сделать? Можно запрещать использовать классы, можно запрещать использовать свойства. 
Возможно, свойства - более эффективно. Простая схема ограничений будет работать, если будет работать 
редактирование базы данных с помощью "усеченных" записей. Это надо проверить. Кажется, я предпринимал для 
этого определенные усилия. 

У меня в голове есть определенная модель рестрикций. Я просто сделаю набор свойств, которые запрещены. 
Причем можно сделать симметричный запрет, когда объектные свойства запрещены в обеих направлениях, а можно 
сделать и несимметричный. Кажется, второе полезнее. Почему я так думаю, дело в том, что по практике 
предыдущих решений, система запретов позволяет к некоторым свойствам подходить только с одной стороны. 
Кажется...

Но есть еще первичные ограничения. В прошлый раз я делал их через темы: семья и др. Кстати, мо

### 20230413 
Я застрял на размышлениях по поводу возможности использования ограничений в древовидном построении.
Проблема заключается в том, что отредактированное значение надо записывать в базу данных. Но при этом, 
нельзя потерять информацию, которую возможно мы не использовали. Похоже, ограничения - это для вьюера. 
При выборе данного для редактирования, нужна вся запись. Попробую.

### 20230414 10:28
Я пытаюсь собрать более или менее приемлемую версию фамильного сайта. Идет медленно, но идет...

Сейчас постараюсь придумать какое-то более радостное оформление. Посмотрю фотографии. Какие могут быть 
идеи? Это может быть композиция из медалей, это может быть композиция из фамилий. Удачная фотография, 
может старая. Посмотрю фотографии и документы. 

### 20230415 15:30
Я доделал разработки режимов gene/edit/view, сделал новое оформление, закоммитил и запушил. Теперь хочу 
вернуться к идеям интерфейса look, в которых я пытался сделать ставку на "шахматку" из композиций. Теперь
у меня есть управляемое построение дерева Rec, соответственно следующий уровень Rec делается в виде
синтезируемой композиции (иконки) прямоугольного размера. 

Пока не начал, надо исправить выдачу прямой ссылки в представлении view. А то там нет ссылок, нет 
картинок. 

### 20230416 16:20
Постоянно "натыкаюсь" на проблемы, которые долго преодолеваю. Вот преодолел проблему в выводе документов.
А надо было поставить:
```
app.MapControllerRoute(name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}");
```

Интересно, что я недавно уже преодолевал эту проблему. Даже не проблему, а недогляд... 4 апреля, я Трошкову про это 
писал. Удивительно как быстро забывается...

Возвращаюсь к первой странице. Даже не первой, а view-странице. Буду делать страницу /view, а потом страницу 
/view/

### 20230417 16:28
Попробую сделать хоть немного. Это будет в режиме look. Беру идентификатор, нахожу RRecord, выделяю 
тип. В зависимости от типа, строю shablon. По шаблону строю Inline-композицию, но без чего-то главного.

### 20230418 11:58
Меня корреспонденка попросила сделать видимость работы. Вот делаю. На самом деле, мы с Трошковым во-многом
застряли. И у меня нет целостной картины использования Rec'ов и у него. 

Пожалуй попробую немного поработать. Идея заключается в том, чтобы какую-то часть информационного портрета
изображать inline, а другую каким-то композиционным способом. Попробую это сделать с коллекцией. 
Шаблон для нее я уже набросал

### 20230422 13:16
Была очень напряженая неделя и я не смог поработать над проектом. Появились некторые точки останова, которые 
попробую сформулировать. Во-первых, у меня нет ясности в том, как пользовать языковыми вариантами. Особенно, 
при редактировании данных. Идея заключается в том, чтобы многоязыковые поля изображались парой выбор языка - 
значение поля. При вводе такого языка может не оказаться, поэтому должна быть команда добавления языка.

Вторая точка останова заключается в принципах построения view-композиций на основе Rec-дерева. Третья точка - 
управление набором используемых отношений. Четверная точка - продумать использование фактографической системы 
для поодержания научного делопроизводства в ИСИ. Вроде много чего есть, но удобной технологии нет. 

Главное, что я застрял на оформлении первых страниц сайта. Попробую сделать это по-старинке. Я уже выделил объект коллекции, даже сделал начальный шаблон. Теперь разрисую этот объект. 





