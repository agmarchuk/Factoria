# Пользовательская документация

Система Фактограф позволяет:

- создавать информационные блоки, называемые кассетами, содержащие в себе хранимые документы и фрагменты базы данных;
- формировать наборы кассет для общей визуализации или редактирования, пользоваться универсальной программой для визуализации и редактирования данных;
- использовать специализированные просмотровые и поисковые интерфейсы, формирующие тематические приложения. 

## Создание кассет с помощью приложения CManager
В репозитории Factoria находим проект CManager. Это Windows (только!) приложение. Оно уже подготовлено к запуску, для чего достаточно активировать файл CManager.exe. Для создания кассеты, нужно выполнить команду File/Create, потом выбрать директорию и имя кассеты (английские буквы и цифры, без пробела). Для тестирования, используем директорию C:\Home\FactographProjects и имя кассеты ttt. После создания, можно через drag-and-drop поместить в кассету файлы и директории. Файлы, в дальнейшем будут рассмотриваться как документы, директории - как коллекции. Для определенности, загрузим в кассету несколько фотографий, лучше тех, где есть персонажи. 

В принципе, загружать можно почти любые файлы, но рекомендуется загружать мультимедиа, т.е. изображения, видео, аудио (аудио временно не загружается), PDF. Эти типы файлов имеют встроенные средства просмотра. Остальные, напр. DOC или DOCX, txt и др. будут загружены, но чтобы с ними работать, надо будет получить из кассеты копию и обрабатывать внешними приложениями. 

В качестве пробы, мы загрузили несколько фотографий известных мне персон, PDF, видео и разные варинаты имиджей (bmp, tiff, gif, png).

Выход из приложения делается по команде File/Exit. Потом можно будет снова запустить эту кассету через запуск CManager'а и команду File/Open. Можно будет добавить другие файлы и директории (вместе с деревом файлов). 

## Визуализация документов и данных с помощью приложения SypBlazor

Приложение SypBlazor, как и некоторые другие приложения, организовано как клиент-сервисная конфигурация. Сервис может быть удаленным и доступен через протокол HTTP. Сервис организует документы и данные, доступные в рамках данного приложения, обеспечивает эффективные процедуры доступа и поиска. Клиент, роль которого играет обычный браузер, создает визуальную обстановку интерфейса приложения, обрабатывает формы, делает запросы сервису и визиализирует результаты. 

Ключевую роль для приложения, как и для других приложений, играет конфигуратор. Конфигуратор, это файл с именем config.xml, доступный приложению через стандартное размещение, в случае SypBlazor этоь файл должен находиться в wwwroot. Файл конфигуратора содержит следующую информацию: список загружаемых в конфигурацию кассет и connectionstring (строку подключения), задающую протокол подключения, место для базы данных. Например:
```
<?xml version="1.0" encoding="utf-8" ?>
<config>
  <!-- Надо указать в connectionstring пустую директорию для базы данных -->
  <database connectionstring="rr:D:\Home\FactographDatabases\sborka1\"/>

  <!-- Надо перечислить загружаемые кассеты. Для тех, в которых допустимо 
    редактирование нужен аттрибут write="true"-->
  <LoadCassette write="true">D:\Home\FactographProjects\ttt</LoadCassette>
</config>
```  
Что здесь записано: загружается кассета ttt из директории D:\Home\FactographProjects\, используется протокол rr, а для базы данных задана директория D:\Home\FactographDatabases\sborka1\ 

Для активации приложения, надо запустить сервис, который будет "повешен" на какой-то порт, а потом запустить клиента, т.е. браузер, прикрепив его к использованному порту. Сделаем это на примере. Сначала в дистрибутиве найдем запускаемый код сервиса. В постом случае, он находится в директории publish. Если такой директории нет, то надо сделать "публикацию", т.е. в приложении SypBlazor запустить команду 
```
dotnet publish  
```
Она сформируем требуемый код с директорией publish. Следующий шаг - создание конфигуратора. Отнеситесь максимально внимательно к действиям этого шага, в этом месте чаще всего случаются ошибки. Надо определить загружаемую кассету (она у вас есть), протокол можно оставить rr, и надо назначить пустую директорию в качестве места для базы данных. Файл конфигуратора помещается в wwwroot. После этого, можно запускать приложение-сервис. Просто активировать SypBlazor.exe. Если все правильно, то приложение создаст сервис, "висящий" на каком-то порте, напр. 5000. Может ипользоваться и другой порт, следите за выдачей приложения после запуска. В браузере набираете адресную строку типа: 
```
localhost:5000
```
клиент подключится к сервису, Web-приложение SypBlazor запущено. 

В поисковом окне набираем "кассеты" - это объединяющая загруженные кассеты коллекция и просматриваем нужное. Если все было сделано правильно, то вы увидите присутствие загруженных ранее документов. 

## Редактирование данных
Редактирование данных (базы данных) осуществляется внесением изменений в fog-файлы установленной конфигурации. Эти изменения можно осуществить вручную с помощью подходящего текстового редактора. У нас в тестовой конфигурации есть только один fog-файл ttt/meta/ttt_current.fog. В текст этого файла можно внести какое-нибудь описание, напр.
```
<person rdf:about="siuucdx">
  <name>Тестов Тест Тестович</name>
  <from-date>2024-05-25</from-date>
</person>
``` 
Здесь определяется персона с указаным через rdf:about идентификатором. Персона имеет указанное имя и указанную дату рождения. После ручного ввода, можно повторить запуск сервиса на основе приложения SypBlazor. Теперь черезж поисковый запрос можно будет увидеть введенную запись с тестовым персонажем. Но можем и не увидеть. Дело в том, что Фактографе есть две базы данных: одна - это RDF-файлы формата XML/RDF/FOG, вторая - бинарная реализация базы данных, необходимая для эффективного доступа к данным. Эти две базы данных синхронизируются либо при изменениях, которые осуществляются параллельно, либо при инициализации приложения, когда по RDF-данным создается (вторая) база данных. Так вот, если вручную внести изменения в RDF-данные, то надо до старта приложения, обнулить вторую базу данных, тогда при старте она восстановится корректно. 

Вручную создавать базу данных сложно и неэффективно. SypBlazor имеет нужные средства делать это. Рассмотрим и попробуем основные моменты. Во-первых, режим редактирования включается только при выполнении условий: пользователю должно быть позволено вносить изменения, а кассете - воспринимать изменения. Второе осуществляется через атрибут конфигуратора write="true". А полномочия пользователя задаются в специальном файле Users.xml, который помещается в wwwroot. Там фиксируются записи вида:
```
<?xml version="1.0" encoding="utf-8" ?>
<users>
	<user>
		<name>mag_9347</name>
		<password>555</password>
    <role>Administrator</role>
	</user>
	<user>
		<name>Sergey</name>
		<password>111</password>
		<role>User</role>
	</user>
	<user>
		<name>misha</name>
		<password>145</password>
		<role>User</role>
	</user>
</users>
```  
В этом файле для данной конфигурации определены три пользователя со своими идентификаторами, паролями и полномочиями. В меню приложения есть раздел Login и если задать идентификтор и пароль, пользователь может быть авторизирован с полномочиями редактора. Может быть, но не обязательно. Должно быть выполнено еще одно условие: среди fog-файлов, входящих в конфигурацию должен существовать файл, у которого: атрибут owner совпадает с идентификатором пользователя, имеются атрибуты prefix и counter, участвующие в формировании новых идентификаторов базы данных. 

Эти (сложные) защитные механизмы предназначены для общего, многопользовательского режима использования приложения, а также для минимизации рисков случайного повреждения данных. Для новичка, в условиях однопользовательсконр режима, можно обойтися минимальными настройками. Дело в том, что кассеты, порождаемые CManager'ом, имеют "встроенного" пользователя mag_9347. А дефолтное определение Users.xml описывает этого пользователя как администратора (в настоящее время, это то же самое, что и пользжователь). И наконец, если вы, как в примере, назначите своей тестовой кассете признак write="true", то у вас все готово к редактированию. Попробуем. В запущенном приложении SypBlazor переходим в раздел Login, далее вводим пользователя mag_9347 и пароль 555. Если все нормально, то вы переходите в режим авторизованного редактирования, что подтверждается последней строкой страницы приложения. 

После авторизации, попробуем редактирование данных. Редактирование состоит из внесения новых, изменения имеющихся и уничтожения ненужных. После активации приложения, у нас имеется два поля для выполнения поисковых операций. Первое поле - текстовое, в нем задается начало поискового образца. Второе поле - выбор варианта типа поискового объекта. Для внесения нового объекта надо (обязательно) указать тип объекта, напр. person и задать его имя (или начало имени) в формате ФИО через пробелы. Будут выданы имеющиеся варианты, что позволяет контролировать нет ли уже персонажа среди имеющихся. Последняя строчка "нов." предназначена именно для внесения нового персонажа указанного типа. Нажатие на нее создаст нужную запись. Для редактирования записи, надо нажать на команду "ред.", для уничтожения - нажать на крестик. 

При редактировании записи имеются некоторые нюансы. Неудачное редактирования следует заканчивать cancel, а успешное ok. Поля записи при ее редактировании могуть быть четырех видов: простые текстовые поля, языковые текстовые поля, перечисления, ссылки на внешние объекты. Простые текстовые поля, напр. даты заполняются обычным образом, даты имеют формат yyyy-mm-dd или левую часть записи даты. Языковые поля состоят из спецификатора языка (в настоящее время встроено только 2 языка: ru и en) и текста на этом языке. Текст печатается на unicode'е, поэтому символы могут быть хоть китайскими... Языковыми полями в случае определения персоны является имя, описание и комментарий. Поле "пол" является перечислимым и задается вариантом. Еще есть ссылки. В случае персоны, это ссылка на отца и ссылка на мать. Ссылки заполняются также как используются поисковые запросы: определяется тип объекта и задается поисковый образец. Если находится подходящий вариант, то он фиксируется в ссылке, если нет, то через команду "нов." создается новый объект, на который устанавливается ссылка. Попробуйте и вы быстро все поймете.

Теперь новый нюанс. После ввода ссылок на родителей, вы, возможно после OK не увидите этих ссылок в записи. Дело в том, что полная система типов и полей для различных типов довольно большая, поэтому сделана попытка сократить ее объем через задание используемых и не используемых тем. В общем меню, нажмите на "Установить параметры", появятся темы и чекбоксы, отмечающие использование тем. В случае родителей, эта тема "семья", нажав на этот вариант, мы будем видеть отношение к родителям, если оно задано. 

Описание (аннотирование) введенных документов, рекомендуется делать следующим образом: через поисковый запрос "кассеты" находится набор введенных кассет, они оформлены как коллекции. Перебираем кассеты и элементы их коллекций, обрабатываем отдельные документы. Это может быть фотография, видео, аудио, PDF, файл. Каждый документ представляет собой запись, содержащую ряд полей. Главным полем является (как с случае персоны) поле имени. По имени можно производить поиск документа, поэтому желательно в имени (если оно не очевидно) как-то особенно характеризовать документ. Поверьте, архив будет довольно унылым если там будут сотни документов напр. с именем "Письмо". В линейной последовательности обрабатываемых документов, целесообразно пользоваться ссылками на следующий, предыдущий и "к источнику". В общем, вы быстро все поймете. 

Кроме имени документ целесообразно встроить в архивную композицию через отношения между документом и сущностями других типов. В простых случаях, это два отношения: отражение и членство в коллекции. Отражение - это кто или что изображен в документе или о ком или о чем в нем рассказано. Напр. есть фотография на которой я был снят в одиночестве или в группе. Тогда стоит для каждого отраженного персонажа установить отношение отражения. Потом, когда мы будем рассматривать этот документ, у нас будет списов тех, кто в нем отражен или упомянут. И наоборот, для каждого персонажа, будет набор документов, в которых этот персонаж присутсвует. Членство в коллекции также часто используется для группировки документов. Обычно это тематическое группированиеЮ напр. "Коллекция документов о нашем походе на Алтай в 2012 году". Эти же документы могут фигурировать в других коллекциях, в частности в кассете, как в коллекции. Уничтожение записей также имеет сущесвенную особенность заключающуюся в том, что команда уничтожения не появляется если есть записи, ссылающиеся на данную. В этом случае надо сначала убрать ссылающиеся отношения, а потом уничтожить запись. 

В используемой онтологии есть довольно много классов и отношений, предназначенных для качественных описаний архивного материала. Их изучение и осваивание требует специальных описаний и специального тренинга. 

## 




